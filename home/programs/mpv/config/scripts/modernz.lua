-- ModernZ (https://github.com/Samillion/ModernZ)
--
-- This script is a derivative of the original mpv-osc-modern by maoiscat
-- and subsequent forks:
--   * cyl0/ModernX
--   * dexeonify/ModernX
--
-- It is based on the official osc.lua from mpv, licensed under the
-- GNU Lesser General Public License v2.1 (LGPLv2.1).
-- Full license: https://www.gnu.org/licenses/old-licenses/lgpl-2.1.html

-- !! Minified !!
local a=require"mp.assdraw"local b=require"mp.msg"local c=require"mp.options"local d=require"mp.utils"local e={language="en",icon_theme="fluent",font="mpv-osd-symbols",idlescreen=true,window_top_bar="auto",showwindowed=true,showfullscreen=true,showonpause=true,keeponpause=true,greenandgrumpy=false,hidetimeout=1500,seek_resets_hidetimeout=true,fadeduration=200,fadein=false,minmousemove=0,bottomhover=true,bottomhover_zone=130,osc_on_seek=false,osc_on_start=false,osc_keep_with_cursor=true,mouse_seek_pause=true,force_seek_tooltip=false,vidscale="auto",scalewindowed=1.0,scalefullscreen=1.0,show_title=true,title="${media-title}",title_font_size=24,chapter_title_font_size=14,cache_info=false,cache_info_speed=false,cache_info_font_size=12,show_chapter_title=true,chapter_fmt="%s",timetotal=true,timems=false,unicodeminus=false,time_format="dynamic",time_font_size=16,tooltip_font_size=14,window_title=false,window_controls=true,windowcontrols_title="${media-title}",raise_subtitles=true,raise_subtitle_amount=125,jump_buttons=true,jump_amount=10,jump_more_amount=60,jump_icon_number=true,jump_mode="relative",jump_softrepeat=true,chapter_skip_buttons=false,chapter_softrepeat=true,track_nextprev_buttons=true,volume_control=true,volume_control_type="linear",playlist_button=true,hide_empty_playlist_button=false,gray_empty_playlist_button=false,fullscreen_button=true,info_button=true,ontop_button=true,screenshot_button=false,screenshot_flag="subtitles",download_button=true,download_path="~~desktop/mpv",loop_button=false,speed_button=false,speed_button_click=1,speed_button_scroll=0.25,loop_in_pause=true,buttons_always_active="none",playpause_size=28,midbuttons_size=24,sidebuttons_size=24,zoom_control=true,zoom_in_max=4,zoom_out_min=-1,osc_color="#000000",window_title_color="#FFFFFF",window_controls_color="#FFFFFF",windowcontrols_close_hover="#F45C5B",windowcontrols_max_hover="#F8BC3A",windowcontrols_min_hover="#43CB44",title_color="#FFFFFF",cache_info_color="#FFFFFF",seekbarfg_color="#FB8C00",seekbarbg_color="#94754F",seekbar_cache_color="#918F8E",volumebar_match_seek_color=false,time_color="#FFFFFF",chapter_title_color="#FFFFFF",side_buttons_color="#FFFFFF",middle_buttons_color="#FFFFFF",playpause_color="#FFFFFF",held_element_color="#999999",hover_effect_color="#FB8C00",thumbnail_border_color="#111111",thumbnail_border_outline="#404040",fade_alpha=130,fade_blur_strength=100,fade_transparency_strength=0,window_fade_alpha=100,window_fade_blur_strength=100,window_fade_transparency_strength=0,thumbnail_border=3,thumbnail_border_radius=3,hover_effect="size,glow,color",hover_button_size=115,button_glow_amount=5,hover_effect_for_sliders=true,tooltips_for_disabled_elements=true,tooltip_hints=true,seek_handle_size=0.8,seekrange=true,seekrangealpha=150,livemarkers=true,seekbarkeyframes=false,nibbles_top=true,nibbles_bottom=true,nibbles_style="triangle",automatickeyframemode=true,automatickeyframelimit=600,persistentprogress=false,persistentprogressheight=17,persistentbuffer=false,visibility="auto",visibility_modes="never_auto_always",tick_delay=0.03,tick_delay_follow_display_fps=false,title_height=96,title_with_chapter_height=108,chapter_title_height=91,time_codes_height=35,time_codes_centered_height=57,tooltip_height_offset=2,tooltip_left_offset=5,portrait_window_trigger=1000,hide_volume_bar_trigger=1150,notitle_osc_h_offset=25,nochapter_osc_h_offset=10,seek_hover_tooltip_h_offset=0,osc_height=132,title_mbtn_left_command="script-binding stats/display-page-5",title_mbtn_mid_command="show-text ${path}",title_mbtn_right_command="script-binding select/select-watch-history; script-message-to modernz osc-hide",playlist_mbtn_left_command="script-binding select/menu; script-message-to modernz osc-hide",playlist_mbtn_right_command="script-binding select/select-playlist; script-message-to modernz osc-hide",vol_ctrl_mbtn_left_command="no-osd cycle mute",vol_ctrl_mbtn_right_command="script-binding select/select-audio-device; script-message-to modernz osc-hide",vol_ctrl_wheel_down_command="no-osd add volume -5",vol_ctrl_wheel_up_command="no-osd add volume 5",audio_track_mbtn_left_command="script-binding select/select-aid; script-message-to modernz osc-hide",audio_track_mbtn_mid_command="cycle audio down",audio_track_mbtn_right_command="cycle audio",audio_track_wheel_down_command="cycle audio",audio_track_wheel_up_command="cycle audio down",sub_track_mbtn_left_command="script-binding select/select-sid; script-message-to modernz osc-hide",sub_track_mbtn_mid_command="cycle sub down",sub_track_mbtn_right_command="cycle sub",sub_track_wheel_down_command="cycle sub",sub_track_wheel_up_command="cycle sub down",chapter_prev_mbtn_left_command="add chapter -1",chapter_prev_mbtn_mid_command="show-text ${chapter-list} 3000",chapter_prev_mbtn_right_command="script-binding select/select-chapter; script-message-to modernz osc-hide",chapter_next_mbtn_left_command="add chapter 1",chapter_next_mbtn_mid_command="show-text ${chapter-list} 3000",chapter_next_mbtn_right_command="script-binding select/select-chapter; script-message-to modernz osc-hide",chapter_title_mbtn_left_command="script-binding select/select-chapter; script-message-to modernz osc-hide",chapter_title_mbtn_right_command="show-text ${chapter-list} 3000",playlist_prev_mbtn_left_command="playlist-prev",playlist_prev_mbtn_mid_command="show-text ${playlist} 3000",playlist_prev_mbtn_right_command="script-binding select/select-playlist; script-message-to modernz osc-hide",playlist_next_mbtn_left_command="playlist-next",playlist_next_mbtn_mid_command="show-text ${playlist} 3000",playlist_next_mbtn_right_command="script-binding select/select-playlist; script-message-to modernz osc-hide",fullscreen_mbtn_left_command="cycle fullscreen",fullscreen_mbtn_right_command="cycle window-maximized",info_mbtn_left_command="script-binding stats/display-page-1-toggle"}mp.observe_property("osc","bool",function(f,g)if g==true then mp.set_property("osc","no")end end)local h={playresy=0,playresx=0,display_aspect=1,unscaled_y=0,areas={},video_margins={l=0,r=0,t=0,b=0}}local i={["fluent"]={iconfont="fluent-system-icons",window={maximize="\238\159\171",unmaximize="\238\174\150",minimize="\238\175\144",close="\239\141\169"},audio="\238\175\139",subtitle="\238\175\141",playlist="\238\161\159",menu="\238\160\170",volume_mute="\238\173\138",volume_quiet="\238\172\184",volume_low="\238\172\189",volume_high="\238\173\130",play="\238\166\143",pause="\238\163\140",replay="\238\189\191",previous="\239\152\167",next="\239\149\168",rewind="\238\168\158",forward="\238\152\135",jump={[5]={"\238\171\186","\238\171\187"},[10]={"\238\171\188","\238\172\129"},[30]={"\238\172\133","\238\172\134"},default={"\238\172\138","\238\172\138"}},fullscreen="\239\133\160",fullscreen_exit="\239\133\166",info="\239\146\164",ontop_on="\238\165\190",ontop_off="\238\166\129",screenshot="\238\169\150",loop_off="\239\133\178",loop_on="\239\133\181",speed="\239\160\177",download="\239\133\144",downloading="\239\140\174",zoom_in="\238\186\142",zoom_out="\238\186\143"},["material"]={iconfont="Material Design Icons",window={maximize='\243\176\150\175',unmaximize='\243\176\150\178',minimize='\243\176\150\176',close='\243\176\150\173'},audio='\243\176\151\133',subtitle='\243\176\168\150',playlist='\243\176\141\156',menu='\243\176\149\178',volume_mute='\243\176\184\136',volume_quiet='\243\176\149\191',volume_low='\243\176\150\128',volume_high='\243\176\149\190',play='\243\176\144\138',pause='\243\176\143\164',replay='\243\176\145\153',previous='\243\176\146\171',next='\243\176\146\172',rewind='\243\176\145\159',forward='\243\176\136\145',jump={[5]={'\243\176\135\185','\243\176\135\184'},[10]={'\243\176\180\170','\243\176\181\177'},[30]={'\243\176\182\150','\243\176\180\134'},default={'\243\176\147\151','\243\176\147\151'}},fullscreen='\243\176\138\147',fullscreen_exit='\243\176\138\148',info='\243\176\139\189',ontop_on='\243\176\144\131',ontop_off='\243\176\164\176',screenshot='\243\176\132\128',loop_off='\243\176\145\151',loop_on='\243\176\145\150',speed='\243\176\163\191',download='\243\176\129\136',downloading='\243\176\166\151',zoom_in='\243\176\155\173',zoom_out='\243\176\155\172'}}local j={["en"]={idle="Drop files or URLs here to play",na="Not available",video="Video",audio="Audio",subtitle="Subtitle",no_subs="No subtitles available",no_audio="No audio tracks available",playlist="Playlist",no_playlist="Playlist is empty",chapter="Chapter",ontop="Pin Window",ontop_disable="Unpin Window",loop_enable="Loop",loop_disable="Disable Loop",speed_control="Speed Control",screenshot="Screenshot",stats_info="Information",cache="Cache",buffering="Buffering",zoom_in="Zoom In",zoom_out="Zoom Out",download="Download",download_in_progress="Download in progress",downloading="Downloading",downloaded="Already downloaded",menu="Menu"}}function get_locale_from_json(k)local l=mp.command_native({'expand-path',k})local m=d.file_info(l)if not m or not m.is_file then return nil end;local n=io.open(l,'r')if not n then return nil end;local o=n:read('*all')n:close()local p,q=d.parse_json(o)if not p then mp.msg.error("JSON parse error:"..q)end;return p end;local r="~~/script-opts/modernz-locale.json"local s=get_locale_from_json(r)if s then for t,u in pairs(s)do if type(u)=="table"then j[t]=u;for v,g in pairs(j["en"])do if u[v]==nil then u[v]=g or""end;if u[v]==nil then mp.msg.warn("Locale key '"..v.."' is nil in language: "..t)end end else mp.msg.warn("Locale data for language "..t.." is not in the correct format.")end end end;local w;local x;local function y()w=i[e.icon_theme]or i["fluent"]x=w.iconfont end;local z;local function A()z=j[e.language]or j["en"]local B="{\\fs24\\1c&H0&\\1c&HFFFFFF&}"z.idle=B..z.idle end;local function C(D,E)local F=type(D)=="table"and D or{}if type(D)~="table"then for G in string.gmatch(D,'([^,]+)')do F[#F+1]=G:match("^%s*(.-)%s*$")end end;for H,I in ipairs(F)do if I==E then return true end end;return false end;local J={width=0,height=0,disabled=true,available=false}local K=1/60;local L=0;local M=0;local N=150;local O=os.date("*t").month==12;local P=string.char(0xe2,0x88,0x92)local function Q(R)return R:sub(6,7)..R:sub(4,5)..R:sub(2,3)end;local S;local function T()local U=e.playpause_size or 28;local V=e.midbuttons_size or 24;local W=e.sidebuttons_size or 24;S={osc_fade_bg="{\\blur"..e.fade_blur_strength.."\\bord"..e.fade_alpha.."\\1c&H0&\\3c&H"..Q(e.osc_color).."&}",window_fade_bg="{\\blur"..e.window_fade_blur_strength.."\\bord"..e.window_fade_alpha.."\\1c&H0&\\3c&H"..Q(e.osc_color).."&}",window_control="{\\blur0\\bord0\\1c&H"..Q(e.window_controls_color).."&\\3c&H0&\\fs25\\fn"..x.."}",window_title="{\\blur1\\bord0.5\\1c&H"..Q(e.window_title_color).."&\\3c&H0&\\fs26\\q2\\fn"..e.font.."}",title="{\\blur1\\bord0.5\\1c&H"..Q(e.title_color).."&\\3c&H0&\\fs"..e.title_font_size.."\\q2\\fn"..e.font.."}",chapter_title="{\\blur0\\bord0\\1c&H"..Q(e.chapter_title_color).."&\\3c&H0&\\fs"..e.chapter_title_font_size.."\\fn"..e.font.."}",seekbar_bg="{\\blur0\\bord0\\1c&H"..Q(e.seekbarbg_color).."&}",seekbar_fg="{\\blur1\\bord1\\1c&H"..Q(e.seekbarfg_color).."&}",thumbnail="{\\blur0\\bord1\\1c&H"..Q(e.thumbnail_border_color).."&\\3c&H"..Q(e.thumbnail_border_outline).."&}",time="{\\blur0\\bord0\\1c&H"..Q(e.time_color).."&\\3c&H0&\\fs"..e.time_font_size.."\\fn"..e.font.."}",cache="{\\blur0\\bord0\\1c&H"..Q(e.cache_info_color).."&\\3c&H0&\\fs"..e.cache_info_font_size.."\\fn"..e.font.."}",tooltip="{\\blur1\\bord0.5\\1c&HFFFFFF&\\3c&H0&\\fs"..e.tooltip_font_size.."\\fn"..e.font.."}",volumebar_bg="{\\blur0\\bord0\\1c&H999999&}",volumebar_fg="{\\blur1\\bord1\\1c&H"..Q(e.side_buttons_color).."&}",control_1="{\\blur0\\bord0\\1c&H"..Q(e.playpause_color).."&\\3c&HFFFFFF&\\fs"..U.."\\fn"..x.."}",control_2="{\\blur0\\bord0\\1c&H"..Q(e.middle_buttons_color).."&\\3c&HFFFFFF&\\fs"..V.."\\fn"..x.."}",control_2_flip="{\\blur0\\bord0\\1c&H"..Q(e.middle_buttons_color).."&\\3c&HFFFFFF&\\fs"..V.."\\fn"..x.."\\fry180}",control_3="{\\blur0\\bord0\\1c&H"..Q(e.side_buttons_color).."&\\3c&HFFFFFF&\\fs"..W.."\\fn"..x.."}",element_down="{\\1c&H"..Q(e.held_element_color).."&}",element_hover="{"..(C(e.hover_effect,"color")and"\\1c&H"..Q(e.hover_effect_color).."&"or"").."\\2c&HFFFFFF&"..(C(e.hover_effect,"size")and string.format("\\fscx%s\\fscy%s",e.hover_button_size,e.hover_button_size)or"").."}"}end;local X={showtime=nil,touchtime=nil,osc_visible=false,anistart=nil,anitype=nil,animation=nil,mouse_down_counter=0,active_element=nil,active_event_source=nil,tc_right_rem=not e.timetotal,tc_ms=e.timems,screen_sizeX=nil,screen_sizeY=nil,initREQ=false,marginsREQ=false,last_mouseX=nil,last_mouseY=nil,mouse_in_window=false,fullscreen=false,tick_timer=nil,tick_last_time=0,hide_timer=nil,cache_state=nil,idle=false,enabled=true,input_enabled=true,showhide_enabled=false,windowcontrols_buttons=false,windowcontrols_title=false,dmx_cache=0,border=true,maximized=false,osd=mp.create_osd_overlay("ass-events"),buffering=false,new_file_flag=false,temp_visibility_mode=nil,chapter_list={},visibility_modes={},mute=false,looping=false,sliderpos=0,touchingprogressbar=false,initialborder=mp.get_property("border"),playtime_hour_force_init=false,playtime_nohour_force_init=false,playing_and_seeking=false,persistent_progress_toggle=e.persistentprogress,user_subpos=mp.get_property_number("sub-pos")or 100,osc_adjusted_subpos=nil,downloaded_once=false,downloading=false,file_size_bytes=0,file_size_normalized="Approximating size...",is_URL=false,is_image=false,url_path=""}local Y={"{\\c&HE5E5E5&\\p6}m 895 10 b 401 10 0 410 0 905 0 1399 401 1800 895 1800 1390 1800 1790 1399 1790 905 1790 410 1390 10 895 10 {\\p0}","{\\c&H682167&\\p6}m 925 42 b 463 42 87 418 87 880 87 1343 463 1718 925 1718 1388 1718 1763 1343 1763 880 1763 418 1388 42 925 42{\\p0}","{\\c&H430142&\\p6}m 1605 828 b 1605 1175 1324 1456 977 1456 631 1456 349 1175 349 828 349 482 631 200 977 200 1324 200 1605 482 1605 828{\\p0}","{\\c&HDDDBDD&\\p6}m 1296 910 b 1296 1131 1117 1310 897 1310 676 1310 497 1131 497 910 497 689 676 511 897 511 1117 511 1296 689 1296 910{\\p0}","{\\c&H691F69&\\p6}m 762 1113 l 762 708 b 881 776 1000 843 1119 911 1000 978 881 1046 762 1113{\\p0}"}local Z={"{\\c&HC0C0C0&\\p6}m 500 -323 b 491 -322 481 -318 475 -311 465 -312 456 -319 446 -318 434 -314 427 -304 417 -297 410 -290 404 -282 395 -278 390 -274 387 -267 381 -265 377 -261 379 -254 384 -253 397 -244 409 -232 425 -228 437 -228 446 -218 457 -217 462 -216 466 -213 468 -209 471 -205 477 -203 482 -206 491 -211 499 -217 508 -222 532 -235 556 -249 576 -267 584 -272 584 -284 578 -290 569 -305 550 -312 533 -309 523 -310 515 -316 507 -321 505 -323 503 -323 500 -323{\\p0}","{\\c&HE0E0E0&\\p6}m 315 -260 b 286 -258 259 -240 246 -215 235 -210 222 -215 211 -211 204 -188 177 -176 172 -151 170 -139 163 -128 154 -121 143 -103 141 -81 143 -60 139 -46 125 -34 129 -17 132 -1 134 16 142 30 145 56 161 80 181 96 196 114 210 133 231 144 266 153 303 138 328 115 373 79 401 28 423 -24 446 -73 465 -123 483 -174 487 -199 467 -225 442 -227 421 -232 402 -242 384 -254 364 -259 342 -250 322 -260 320 -260 317 -261 315 -260{\\p0}","{\\c&H0000F0&\\p6}m 1151 -523 b 1016 -516 891 -458 769 -406 693 -369 624 -319 561 -262 526 -252 465 -235 479 -187 502 -147 551 -135 588 -111 1115 165 1379 232 1909 761 1926 800 1952 834 1987 858 2020 883 2053 912 2065 952 2088 1000 2146 962 2139 919 2162 836 2156 747 2143 662 2131 615 2116 567 2122 517 2120 410 2090 306 2089 199 2092 147 2071 99 2034 64 1987 5 1928 -41 1869 -86 1777 -157 1712 -256 1629 -337 1578 -389 1521 -436 1461 -476 1407 -509 1343 -507 1284 -515 1240 -519 1195 -521 1151 -523{\\p0}","{\\c&H0000AA&\\p6}m 1657 248 b 1658 254 1659 261 1660 267 1669 276 1680 284 1689 293 1695 302 1700 311 1707 320 1716 325 1726 330 1735 335 1744 347 1752 360 1761 371 1753 352 1754 331 1753 311 1751 237 1751 163 1751 90 1752 64 1752 37 1767 14 1778 -3 1785 -24 1786 -45 1786 -60 1786 -77 1774 -87 1760 -96 1750 -78 1751 -65 1748 -37 1750 -8 1750 20 1734 78 1715 134 1699 192 1694 211 1689 231 1676 246 1671 251 1661 255 1657 248 m 1909 541 b 1914 542 1922 549 1917 539 1919 520 1921 502 1919 483 1918 458 1917 433 1915 407 1930 373 1942 338 1947 301 1952 270 1954 238 1951 207 1946 214 1947 229 1945 239 1939 278 1936 318 1924 356 1923 362 1913 382 1912 364 1906 301 1904 237 1891 175 1887 150 1892 126 1892 101 1892 68 1893 35 1888 2 1884 -9 1871 -20 1859 -14 1851 -6 1854 9 1854 20 1855 58 1864 95 1873 132 1883 179 1894 225 1899 273 1908 362 1910 451 1909 541{\\p0}","{\\c&HF8F8F8&\\p6}m 626 -191 b 565 -155 486 -196 428 -151 387 -115 327 -101 304 -47 273 2 267 59 249 113 219 157 217 213 215 265 217 309 260 302 285 283 373 264 465 264 555 257 608 252 655 292 709 287 759 294 816 276 863 298 903 340 972 324 1012 367 1061 394 1125 382 1167 424 1213 462 1268 482 1322 506 1385 546 1427 610 1479 662 1510 690 1534 725 1566 752 1611 796 1664 830 1703 880 1740 918 1747 986 1805 1005 1863 991 1897 932 1916 880 1914 823 1945 777 1961 725 1979 673 1957 622 1938 575 1912 534 1862 515 1836 473 1790 417 1755 351 1697 305 1658 266 1633 216 1593 176 1574 138 1539 116 1497 110 1448 101 1402 77 1371 37 1346 -16 1295 15 1254 6 1211 -27 1170 -62 1121 -86 1072 -104 1027 -128 976 -133 914 -130 851 -137 794 -162 740 -181 679 -168 626 -191 m 2051 917 b 1971 932 1929 1017 1919 1091 1912 1149 1923 1214 1970 1254 2000 1279 2027 1314 2066 1325 2139 1338 2212 1295 2254 1238 2281 1203 2287 1158 2282 1116 2292 1061 2273 1006 2229 970 2206 941 2167 938 2138 918{\\p0}"}local function _()X.anistart=nil;X.animation=nil;X.anitype=nil end;local function a0(a1,a2,a3,a4)if X.osd.res_x==a1 and X.osd.res_y==a2 and X.osd.data==a3 then return end;X.osd.res_x=a1;X.osd.res_y=a2;X.osd.data=a3;X.osd.z=a4;X.osd:update()end;local function a5(a6,a7)if a6 then X.tc_right_rem=not e.timetotal end;if a7 then X.tc_ms=e.timems end end;local function a8()local a9,aa=mp.get_osd_size()if a9<=0 or aa<=0 then return 0,0 end;return h.playresx/a9,h.playresy/aa end;local function ab()if X.mouse_in_window then local ac,ad=a8()local ae,af=mp.get_mouse_pos()return ae*ac,af*ad else return-1,-1 end end;local function ag(ah,ai,aj,ak,f)local ac,ad=a8()mp.set_mouse_area(ah/ac,ai/ad,aj/ac,ak/ad,f)end;local function al(ah,aj,ai,ak,am)local an=(ak-ai)/(aj-ah)local ao=ai-an*ah;return an*am+ao end;local function ap(ae,af,aq,a9,aa)local ar={[1]=function()return ae,af-aa,ae+a9,af end,[2]=function()return ae-a9/2,af-aa,ae+a9/2,af end,[3]=function()return ae-a9,af-aa,ae,af end,[4]=function()return ae,af-aa/2,ae+a9,af+aa/2 end,[5]=function()return ae-a9/2,af-aa/2,ae+a9/2,af+aa/2 end,[6]=function()return ae-a9,af-aa/2,ae,af+aa/2 end,[7]=function()return ae,af,ae+a9,af+aa end,[8]=function()return ae-a9/2,af,ae+a9/2,af+aa end,[9]=function()return ae-a9,af,ae,af+aa end}return ar[aq]()end;local function as(at)return ap(at.x,at.y,at.an,at.w,at.h)end;local function au(av)return av.hitbox.x1,av.hitbox.y1,av.hitbox.x2,av.hitbox.y2 end;local function aw(ax,ay,az,aA)local aB,aC=ab()return aB>=ax and aB<=az and aC>=ay and aC<=aA end;local function aD(av)return aw(au(av))end;local function aE(aF,aG,am)if am>aG then am=aG elseif am<aF then am=aF end;return am end;local function aH(av,am)local aI=al(av.slider.min.value,av.slider.max.value,av.slider.min.ele_pos,av.slider.max.ele_pos,am)return aE(av.slider.min.ele_pos,av.slider.max.ele_pos,aI)end;local function aJ(av,aK)if av then local am=al(av.slider.min.glob_pos,av.slider.max.glob_pos,av.slider.min.value,av.slider.max.value,aK)return aE(av.slider.min.value,av.slider.max.value,am)end;return 0 end;local function aL(av)return aJ(av,ab())end;local function aM(aN,aO)return 255-(1-aN/255)*(1-aO/255)*255 end;local function aP(f,aj,ak,aQ,aR)if h.areas[f]==nil then h.areas[f]={}end;table.insert(h.areas[f],{x1=aj,y1=ak,x2=aQ,y2=aR})end;local function aS(aT,aU,aV,aW)local aX={}for aY,aZ in pairs(aU)do aZ=aM(aZ,aV)if X.animation then local a_=X.animation;if aW then a_=255-a_ end;aZ=aM(aZ,a_)end;aX[aY]=aZ end;aT:append(string.format("{\\1a&H%X&\\2a&H%X&\\3a&H%X&\\4a&H%X&}",aX[1],aX[2],aX[3],aX[4]))end;local function b0(aT,ae,af,b1)aT:round_rect_cw(ae-b1,af-b1,ae+b1,af+b1,b1)end;local function b2(aT,ah,ai,aj,ak,b3,b4,b5)if b4 then aT:hexagon_cw(ah,ai,aj,ak,b3,b5)else aT:round_rect_cw(ah,ai,aj,ak,b3,b5)end end;local function b6()if e.visibility=="always"then return-1 end;return e.hidetimeout end;local function b7()if X.touchtime==nil then return 0 end;return X.touchtime+b6()/1000-mp.get_time()end;local function b8()return X.cache_state and#X.cache_state["seekable-ranges"]>0 end;local function b9()local ba=h.video_margins;if not X.osc_visible or b6()>=0 or X.fullscreen and not e.showfullscreen or not X.fullscreen and not e.showwindowed then ba={l=0,r=0,t=0,b=0}end;mp.set_property_native("user-data/osc/margins",ba)end;local bb;local function bc()if X.tick_timer==nil then X.tick_timer=mp.add_timeout(0,bb)end;if not X.tick_timer:is_enabled()then local bd=mp.get_time()local be=K-(bd-X.tick_last_time)if be<0 then be=0 end;X.tick_timer.timeout=be;X.tick_timer:resume()end end;local function bf()X.initREQ=true;bc()end;local function bg()bf()X.tick_timer:kill()X.tick_timer.timeout=0;X.tick_timer:resume()end;local function bh()b.trace("render_wipe()")X.osd.data=""X.osd:remove()end;local function bi()L,M=0,0;for H,bj in pairs(mp.get_property_native("track-list"))do if bj.type=="audio"then L=L+1 elseif bj.type=="sub"then M=M+1 end end end;local function bk(bl)local bm=bl;if e.volume_control_type=="logarithmic"then bm=bl^2/100 end;return math.floor(bm)end;local function bn()local am=e.window_top_bar;if am=="auto"then return not(X.border and X.title_bar)or X.fullscreen else return am=="yes"end end;local bo={}local function bp()local bq={}for H,av in pairs(bo)do if av.layout~=nil and av.visible then table.insert(bq,av)end end;bo=bq;local function br(bs,ao)return bs.layout.layer<ao.layout.layer end;table.sort(bo,br)for H,av in pairs(bo)do local bt=av.layout.geometry;local ax,ay,az,aA=as(bt)av.hitbox={x1=ax,y1=ay,x2=az,y2=aA}local bu=a.ass_new()bu:append("{}")bu:new_event()bu:pos(bt.x,bt.y)bu:an(bt.an)bu:append(av.layout.style)av.style_ass=bu;local bv=a.ass_new()if av.type=="box"then bv:draw_start()b2(bv,0,0,bt.w,bt.h,av.layout.box.radius,av.layout.box.hexagon)bv:draw_stop()elseif av.type=="slider"then local bw=av.layout.slider;av.slider.min.ele_pos=e.seek_handle_size>0 and e.seek_handle_size*bt.h/2 or bw.border;av.slider.max.ele_pos=bt.w-av.slider.min.ele_pos;av.slider.min.glob_pos=av.hitbox.x1+av.slider.min.ele_pos;av.slider.max.glob_pos=av.hitbox.x1+av.slider.max.ele_pos;bv:draw_start()bv:rect_cw(0,0,bt.w,bt.h)bv:rect_ccw(0,0,bt.w,bt.h)if av.slider.markerF~=nil and bw.gap>0 then local bx=av.slider.markerF()for H,by in pairs(bx)do if by>=av.slider.min.value and by<=av.slider.max.value then local bz=aH(av,by)if bw.gap>5 then local bA=3;if bw.nibbles_top then if bw.nibbles_style=="triangle"then bv:move_to(bz-3,bw.gap-5)bv:line_to(bz+3,bw.gap-5)bv:line_to(bz,bw.gap-1)elseif bw.nibbles_style=="bar"then bv:rect_cw(bz-1,bw.gap-bA,bz+1,bw.gap)else bv:rect_cw(bz-1,bw.gap-bA,bz+1,bt.h-bw.gap)end end;if bw.nibbles_bottom then if bw.nibbles_style=="triangle"then bv:move_to(bz-3,bt.h-bw.gap+5)bv:line_to(bz,bt.h-bw.gap+1)bv:line_to(bz+3,bt.h-bw.gap+5)elseif bw.nibbles_style=="bar"then bv:rect_cw(bz-1,bt.h-bw.gap,bz+1,bt.h-bw.gap+bA)else bv:rect_cw(bz-1,bw.gap,bz+1,bt.h-bw.gap+bA)end end else if bw.nibbles_top then bv:rect_cw(bz-1,0,bz+1,bw.gap)end;if bw.nibbles_bottom then bv:rect_cw(bz-1,bt.h-bw.gap,bz+1,bt.h)end end end end end end;av.static_ass=bv;if not av.enabled then av.layout.alpha[1]=215;if not(av.name=="sub_track"or av.name=="audio_track"or av.name=="tog_playlist")then av.eventresponder=nil end end;if av.off then av.layout.alpha[1]=100 end end end;local function bB(bC)local bD=X.chapter_list;for bE=#bD,1,-1 do if bC>=bD[bE].time then return bD[bE]end end end;local function bF(av,bG,bH)local bI=av.slider.posF()if not bI then return 0,0 end;local bJ=e.seek_handle_size>0;local bt=av.layout.geometry;local bK=bJ and e.seek_handle_size*bt.h/2 or 0;local bL=aH(av,bI)local bM=aw(av.hitbox.x1+bL-bK,av.hitbox.y1+bt.h/2-bK,av.hitbox.x1+bL+bK,av.hitbox.y1+bt.h/2+bK)and av.enabled;if bJ then if bM and e.hover_effect_for_sliders then if C(e.hover_effect,"size")then bK=bK*e.hover_button_size/100 end end;b0(bG,bL,bt.h/2,bK)if e.hover_effect_for_sliders then bG:draw_stop()bG:merge(av.style_ass)aS(bG,av.layout.alpha,bH or 0)bG:merge(av.static_ass)end;return bL,bK end;return bL,0 end;local function bN(av,bG,bL,bK,bH)local bO=bL and bK;bL=bL or 0;bK=bK or 0;local bw=av.layout.slider;local bt=av.layout.geometry;local bP=av.slider.seekRangesF()if not bP then return end;bG:draw_stop()bG:merge(av.style_ass)aS(bG,av.layout.alpha,bH or e.seekrangealpha)bG:append("{\\1cH&"..Q(e.seekbar_cache_color).."&}")bG:merge(av.static_ass)for H,bQ in pairs(bP)do local bR=math.max(0,aH(av,bQ["start"])-bw.gap)local bS=math.min(bt.w,aH(av,bQ["end"])+bw.gap)if bO and(bR<bL+bK and bS>bL-bK)then if bR<bL-bK then bG:rect_cw(bR,bw.gap,bL-bK,bt.h-bw.gap)end;bR=bL+bK end;if bS>bR then bG:rect_cw(bR,bw.gap,bS,bt.h-bw.gap)end end end;local function bT(av,bG)local bI=av.slider.posF()if not bI then return end;local bL=aH(av,bI)local bw=av.layout.slider;local bt=av.layout.geometry;bG:rect_cw(0,bw.gap,bL,bt.h-bw.gap)end;local function bU(bV)X.forced_title=nil;if J.disabled then local bW,bX=X.slider_element,bo[X.active_element]if e.chapter_fmt~="no"and X.touchingprogressbar then local bY=mp.get_property_number("duration",0)if bY>0 then local bZ=bB(X.sliderpos*bY/100)if bZ and bZ.title and bZ.title~=""then X.forced_title=string.format(e.chapter_fmt,bZ.title)end end end end;X.touchingprogressbar=false;for bE=1,#bo do local av=bo[bE]local bu=a.ass_new()bu:merge(av.style_ass)aS(bu,av.layout.alpha,0)if av.eventresponder and X.active_element==bE then if av.eventresponder.render~=nil then av.eventresponder.render(av)end;if aD(av)then if av.styledown then bu:append(S.element_down)end;if av.softrepeat and X.mouse_down_counter>=15 and X.mouse_down_counter%5==0 then av.eventresponder[X.active_event_source.."_down"](av)end;X.mouse_down_counter=X.mouse_down_counter+1 end end;local bG=a.ass_new()bG:merge(bu)if av.type~="button"then bG:merge(av.static_ass)end;if av.type=="slider"then if av.name~="persistentseekbar"then local bw=av.layout.slider;local bt=av.layout.geometry;local b_=av.slider.min.value;local c0=av.slider.max.value;local bL,bK=bF(av,bG)bT(av,bG)bN(av,bG,bL,bK)bG:draw_stop()if av.slider.tooltipF~=nil and av.enabled then local c1=e.force_seek_tooltip and av.name=="seekbar"and av.eventresponder["mbtn_left_down"]and av.state.mbtnleft and X.mouse_down_counter>0 and X.playing_and_seeking;if aD(av)or c1 then local c2=aL(av)local c3=av.slider.tooltipF(c2)local aq=bw.tooltip_an;local c4;if aq==2 then c4=av.hitbox.y1-e.seek_hover_tooltip_h_offset else c4=av.hitbox.y1+bt.h/2-e.seek_hover_tooltip_h_offset end;local c5=ab()if bw.adjust_tooltip then if aq==2 then if c2<b_+3 then aq=aq-1 elseif c2>c0-3 then aq=aq+1 end elseif c2>(c0+b_)/2 then aq=aq+1;c5=c5-5 else aq=aq-1;c5=c5+10 end end;if av.name=="seekbar"then X.sliderpos=c2 end;if J.disabled and not e.show_title and not e.show_chapter_title then local c6=mp.get_property_number("osd-width")local c7,c8=a8()if c6 then if e.chapter_fmt~="no"and X.touchingprogressbar then local bY=mp.get_property_number("duration",0)if bY>0 then local bZ=bB(X.sliderpos*bY/100)if bZ and bZ.title and bZ.title~=""then local c9=math.min(c6-50/c7,math.max(60/c7,c5/c7))local ca=c4-e.time_font_size*1.3;bG:new_event()bG:pos(c9*c7,ca)bG:an(2)bG:append(bw.tooltip_style)aS(bG,bw.alpha,0)bG:append(string.format(e.chapter_fmt,bZ.title))end end end end elseif av.thumbnailable and not J.disabled then local c6=mp.get_property_number("osd-width")local c7,c8=a8()if c6 then local cb=0;if mp.get_property_number("duration")then cb=mp.get_property_number("duration")*c2/100 end;local cc=e.thumbnail_border;local cd=18/c7;local ce=e.time_font_size+cc+2/c8;local cf=math.min(c6-J.width-cd,math.max(cd,c5/c7-J.width/2))local cg=(c4-ce)/c8-J.height;cf=math.floor(cf+0.5)cg=math.floor(cg+0.5)if X.anitype==nil then bG:new_event()bG:append("{\\rDefault}")bG:pos(cf*c7,c4-ce-J.height*c8)bG:an(7)bG:append(S.thumbnail)bG:draw_start()if e.thumbnail_border_radius and e.thumbnail_border_radius>0 then bG:round_rect_cw(-cc*c7,-cc*c8,(J.width+cc)*c7,(J.height+cc)*c8,e.thumbnail_border_radius)else bG:rect_cw(-cc*c7,-cc*c8,(J.width+cc)*c7,(J.height+cc)*c8)end;bG:draw_stop()c5=(cf+J.width/2)*c7;aq=2;mp.commandv("script-message-to","thumbfast","thumb",cb,cf,cg)end;local bW,bX=X.slider_element,bo[X.active_element]if e.chapter_fmt~="no"and X.touchingprogressbar then local bY=mp.get_property_number("duration",0)if bY>0 then local bZ=bB(X.sliderpos*bY/100)if bZ and bZ.title and bZ.title~=""then bG:new_event()bG:pos((cf+J.width/2)*c7,cg*c8-e.time_font_size/2)bG:an(aq)bG:append(bw.tooltip_style)aS(bG,bw.alpha,0)bG:append(string.format(e.chapter_fmt,bZ.title))end end end end end;bG:new_event()bG:pos(c5,c4)bG:an(aq)bG:append(bw.tooltip_style)aS(bG,bw.alpha,0)bG:append(c3)elseif av.thumbnailable and J.available then mp.commandv("script-message-to","thumbfast","clear")end end end elseif av.type=="button"then local ch;if type(av.content)=="function"then ch=av.content()elseif av.content~=nil then ch=av.content end;local ci=av.layout.button.maxchars;if ci~=nil and#ch>ci then local cj=1.25;local ck=math.max(0,math.floor(ci*cj)-3)if#ch>ck then while#ch>ck do ch=ch:gsub(".[\128-\191]*$","")end;ch=ch.."..."end;ch=string.format("{\\fscx%f}",ci/#ch*100)..ch end;local cl=av.layout.button;local cm=av.eventresponder and(av.eventresponder["mbtn_left_down"]~=nil or av.eventresponder["mbtn_left_up"]~=nil)local cn=aD(av)and cm and av.enabled and X.mouse_down_counter==0;local co=cl.hoverstyle;if cn and(C(e.hover_effect,"size")or C(e.hover_effect,"color"))then if av.name=="title"or av.name=="time_codes"or av.name=="chapter_title"or av.name=="cache_info"then co=co:gsub("\\fscx%d+\\fscy%d+","")end;bG:append(co..ch)else bG:append(ch)end;if cn and C(e.hover_effect,"glow")then local cp=a.ass_new()cp:merge(bu)cp:append("{\\blur"..e.button_glow_amount.."}"..co..ch)bG:merge(cp)end;if av.tooltipF~=nil and(e.tooltips_for_disabled_elements or av.enabled)then if aD(av)then local c3=av.tooltipF;local aq=1;local c4=av.hitbox.y1-e.tooltip_height_offset;local c5=ab()if c4<h.playresy/2 then c4=av.hitbox.y2-e.tooltip_height_offset;aq=7 end;if av.enabled then if type(av.tooltipF)=="function"then c3=av.tooltipF()else c3=av.tooltipF end else c3=av.nothingavailable end;if c5>h.playresx/2 then c5=c5-string.len(c3)*e.tooltip_left_offset end;bG:new_event()bG:append("{\\rDefault}")bG:pos(c5,c4)bG:an(aq)bG:append(av.tooltip_style)bG:append(c3)end end end;bV:merge(bG)end end;local function cq(bV)for bE=1,#bo do local av=bo[bE]if av.name=="persistentseekbar"then local bu=a.ass_new()bu:merge(av.style_ass)if X.animation or not X.osc_visible then aS(bu,av.layout.alpha,0,true)local bG=a.ass_new()bG:merge(bu)if av.type~="button"then bG:merge(av.static_ass)end;bT(av,bG)if e.persistentbuffer then bN(av,bG,nil,nil)end;bG:draw_stop()bV:merge(bG)end end end end;local function cr(bz)if not bz then e.download_button=false;return false end;local cs="^[%w]+://[%w%.%-_]+%.[%a]+[-%w%.%-%_/?&=]*"return string.match(bz,cs)~=nil end;local function ct(cu)for cv=#cu,1,-1 do if cu[cv]==nil or cu[cv]==""then table.remove(cu,cv)end end;mp.command_native_async({name="subprocess",args=cu,capture_stdout=true,capture_stderr=true},function(cw,am)local cx=am.stdout;X.file_size_bytes=tonumber(cx)if X.file_size_bytes then X.file_size_normalized=d.format_bytes_humanized(X.file_size_bytes)b.info("Download size: "..X.file_size_normalized)else local cy=mp.get_property_osd("file-size")if cy and cy~=""then X.file_size_normalized=cy;b.info("Download size: "..cy)else X.file_size_normalized="Unknown"b.info("Unable to retrieve file size.")end end;bc()end)end;local function cz(cA,cB,cC)if cA then local cD=mp.command_native({"expand-path",e.download_path})mp.command("show-text 'Download saved to "..cD.."'")X.downloaded_once=true;b.info("Download completed")else mp.command("show-text 'Download failed - "..(cC or"Unknown error").."'")b.info("Download failed")end;X.downloading=false end;local function cE(cu,cF)for cv=#cu,1,-1 do if cu[cv]==nil or cu[cv]==""then table.remove(cu,cv)end end;b.info("Executing command: "..table.concat(cu," "))local cG=mp.command_native_async({name="subprocess",args=cu,capture_stdout=true,capture_stderr=true},cF)return cG and cG.status or nil end;local function cH()X.is_URL=false;X.downloading=false;local k=mp.get_property("path")if not k then return nil end;if string.find(k,"https://")then k=string.gsub(k,"ytdl://","")else k=string.gsub(k,"ytdl://","https://")end;local cI=mp.get_property("file-local-options/ytdl-format")or mp.get_property("ytdl-format")or""local cJ=cI and cI~=""and"-f "..cI or"-f ".."bestvideo+bestaudio/best"if cr(k)then X.is_URL=true;X.url_path=k;b.info("URL detected.")if e.download_button then b.info("Fetching file size...")local cK={"yt-dlp",X.is_image and""or cJ,"--no-download","-O","%(filesize,filesize_approx)s",k}ct(cK)end end end;local function cL(f,type)bo[f]={}bo[f].type=type;bo[f].name=f;bo[f].eventresponder={}bo[f].visible=true;bo[f].enabled=true;bo[f].softrepeat=false;bo[f].styledown=type=="button"bo[f].state={}if type=="slider"then bo[f].slider={min={value=0},max={value=100}}bo[f].thumbnailable=false end;return bo[f]end;local function cM(f)if bo[f]~=nil then bo[f].layout={}bo[f].layout.layer=50;bo[f].layout.alpha={[1]=0,[2]=255,[3]=255,[4]=255}if bo[f].type=="button"then bo[f].layout.button={maxchars=nil,hoverstyle=S.element_hover}elseif bo[f].type=="slider"then bo[f].layout.slider={border=1,gap=1,nibbles_top=e.nibbles_top,nibbles_bottom=e.nibbles_bottom,nibbles_style=e.nibbles_style,adjust_tooltip=true,tooltip_style="",tooltip_an=2,alpha={[1]=0,[2]=255,[3]=88,[4]=255},hoverstyle=S.element_hover:gsub("\\fscx%d+\\fscy%d+","")}elseif bo[f].type=="box"then bo[f].layout.box={radius=0,hexagon=false}end;return bo[f].layout else b.error("Can't add_layout to element '"..f.."', doesn't exist.")end end;local function cN()local cO={x=0,y=50,an=1,w=h.playresx,h=50}local cP;local cQ=N;local cR=cO.w-cQ;local cS=cO.w-cQ;local cT=cO.x;local cU=cO.w-cQ;local cV=cO.y-cO.h/2;local cW={x=cS+25,y=cV,an=5,w=50,h=cO.h}local cX={x=cS+75,y=cV,an=5,w=49,h=cO.h}local cY={x=cS+125,y=cV,an=5,w=50,h=cO.h}if e.window_controls then cP=cM("close")cP.geometry=cY;cP.style=S.window_control;cP.button.hoverstyle="{\\c&H"..Q(e.windowcontrols_close_hover).."&"..(C(e.hover_effect,"size")and string.format("\\fscx%s\\fscy%s",e.hover_button_size,e.hover_button_size)or"").."}"cP=cM("minimize")cP.geometry=cW;cP.style=S.window_control;cP.button.hoverstyle="{\\c&H"..Q(e.windowcontrols_min_hover).."&"..(C(e.hover_effect,"size")and string.format("\\fscx%s\\fscy%s",e.hover_button_size,e.hover_button_size)or"").."}"cP=cM("maximize")cP.geometry=cX;cP.style=S.window_control;cP.button.hoverstyle="{\\c&H"..Q(e.windowcontrols_max_hover).."&"..(C(e.hover_effect,"size")and string.format("\\fscx%s\\fscy%s",e.hover_button_size,e.hover_button_size)or"").."}"aP("window-controls",ap(cS,cO.y,cO.an,cQ,cO.h))end;if e.window_title then cP=cM("windowtitle")cP.geometry={x=20,y=cV+14,an=1,w=h.playresx-50,h=cO.h}cP.style=string.format("%s{\\clip(%f,%f,%f,%f)}",S.window_title,cT,cO.y-cO.h,cU,cO.y+cO.h)aP("window-controls-title",cT,0,cU,cO.h)end end;local cZ={}cZ["modern"]=function()local c_=(e.title_mbtn_left_command==""or e.title_mbtn_left_command=="ignore")and(e.title_mbtn_right_command==""or e.title_mbtn_right_command=="ignore")or not e.show_title;local d0=(e.chapter_title_mbtn_left_command==""or e.chapter_title_mbtn_left_command=="ignore")and(e.chapter_title_mbtn_right_command==""or e.chapter_title_mbtn_right_command=="ignore")or not e.show_chapter_title;local d1=e.show_chapter_title and mp.get_property_number("chapter",-1)>=0;local d2=(c_ and e.notitle_osc_h_offset or 0)+((d0 or not d1)and e.nochapter_osc_h_offset or 0)local d3={w=h.playresx,h=e.osc_height-d2}h.video_margins.b=math.max(e.osc_height,e.fade_alpha)/h.playresy;local d4=0;local d5=h.playresy;h.areas={}aP("input",ap(d4,d5,1,d3.w,d3.h))aP("showhide",0,0,h.playresx,h.playresy)local d6,d7=d3.w,d3.h;local cP,d8;cL("osc_fade_bg","box")cP=cM("osc_fade_bg")cP.geometry={x=d4,y=d5,an=7,w=d6,h=1}cP.style=S.osc_fade_bg;cP.layer=10;cP.alpha[3]=e.fade_transparency_strength;local d9=bn()and(e.window_title or e.window_controls)if(e.window_top_bar=="yes"or not(X.border and X.title_bar)or X.fullscreen)and d9 then cL("window_bar_alpha_bg","box")cP=cM("window_bar_alpha_bg")cP.geometry={x=d4,y=-100,an=7,w=d6,h=-1}cP.style=S.window_fade_bg;cP.layer=10;cP.alpha[3]=e.window_fade_transparency_strength end;local da=d6/2;local db=d5;cL("seekbarbg","box")cP=cM("seekbarbg")local dc=4;cP.geometry={x=da,y=db-72,an=5,w=d3.w-50,h=dc}cP.layer=13;cP.style=S.seekbar_bg;cP.alpha[1]=128;cP.alpha[3]=128;cP=cM("seekbar")local dd=18;cP.geometry={x=da,y=db-72,an=5,w=d3.w-50,h=dd}cP.layer=51;cP.style=S.seekbar_fg;cP.slider.gap=(dd-dc)/2.0;cP.slider.tooltip_style=S.tooltip;cP.slider.tooltip_an=2;if e.persistentprogress or X.persistent_progress_toggle then cP=cM("persistentseekbar")cP.geometry={x=da,y=db,an=5,w=d3.w,h=e.persistentprogressheight}cP.style=S.seekbar_fg;cP.slider.gap=(dd-dc)/2.0;cP.slider.tooltip_an=0 end;local de=L>0;local df=M>0;local dg=e.jump_buttons;local dh=e.chapter_skip_buttons;local di=e.track_nextprev_buttons;local dj=e.fullscreen_button;local dk=e.info_button;local dl=e.ontop_button;local dm=e.screenshot_button;local dn=e.loop_button;local dp=e.speed_button;local dq=e.download_button and X.is_URL;local dr=e.playlist_button and(not e.hide_empty_playlist_button or mp.get_property_number("playlist-count",0)>1)local ds=dg and 60 or 0;local dt=(dh and 0 or 100)+(dg and 0 or 100)d8={x=25,y=db-(d1 and e.title_with_chapter_height or e.title_height),an=1,w=d3.w-50-(dn and 45 or 0)-(dp and 45 or 0),h=e.title_font_size}cP=cM("title")cP.geometry=d8;cP.style=string.format("%s{\\clip(0,%f,%f,%f)}",S.title,d8.y-d8.h,d8.x+d8.w,d8.y+d8.h)cP.alpha[3]=0;if e.show_chapter_title then cP=cM("chapter_title")cP.geometry={x=26,y=db-e.chapter_title_height,an=1,w=d3.w/2,h=e.chapter_title_font_size}cP.style=string.format("%s{\\clip(0,%f,%f,%f)}",S.chapter_title,d8.y-d8.h,d8.x+d8.w,d8.y+d8.h)end;if di then cP=cM("playlist_prev")cP.geometry={x=da-(60+(dh and 60 or 0))-ds,y=db-35,an=5,w=30,h=24}cP.style=S.control_2 end;if dh then cP=cM("chapter_backward")cP.geometry={x=da-60-ds,y=db-35,an=5,w=30,h=24}cP.style=S.control_2 end;if dg then cP=cM("jump_backward")cP.geometry={x=da-60,y=db-35,an=5,w=30,h=24}cP.style=e.jump_icon_number and w.jump[e.jump_amount]~=nil and S.control_2 or S.control_2_flip end;cP=cM("play_pause")cP.geometry={x=da,y=db-35,an=5,w=45,h=28}cP.style=S.control_1;if dg then cP=cM("jump_forward")cP.geometry={x=da+60,y=db-35,an=5,w=30,h=24}cP.style=S.control_2 end;if dh then cP=cM("chapter_forward")cP.geometry={x=da+60+ds,y=db-35,an=5,w=30,h=24}cP.style=S.control_2 end;if di then cP=cM("playlist_next")cP.geometry={x=da+60+(dh and 60 or 0)+ds,y=db-35,an=5,w=30,h=24}cP.style=S.control_2 end;local du=37;if dr then cP=cM("tog_playlist")cP.geometry={x=du,y=db-35,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=600-dt;du=du+45 end;if de then cP=cM("audio_track")cP.geometry={x=du,y=db-35,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=500-dt;du=du+45 end;if df then cP=cM("sub_track")cP.geometry={x=du,y=db-35,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=600-dt;du=du+45 end;if de then cP=cM("vol_ctrl")cP.geometry={x=du,y=db-35,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=600-dt;du=du+28;cP=cL("volumebarbg","box")cP.visible=h.playresx>=1150-dt and e.volume_control;cP=cM("volumebarbg")cP.geometry={x=du,y=db-35,an=4,w=55,h=4}cP.layer=13;cP.alpha[1]=128;cP.style=e.volumebar_match_seek_color and S.seekbar_bg or S.volumebar_bg;cP=cM("volumebar")cP.geometry={x=du,y=db-35,an=4,w=55,h=10}cP.style=e.volumebar_match_seek_color and S.seekbar_fg or S.volumebar_fg;cP.slider.gap=3;cP.slider.tooltip_style=S.tooltip;cP.slider.tooltip_an=2;du=du+75 end;local dv=mp.get_property_number("playtime-remaining",0)local bY=mp.get_property_number("duration",0)local dw=mp.get_property_number("playback-time",0)>=3600 or e.time_format~="dynamic"local dx=X.tc_right_rem and dv>=3600 or not X.tc_right_rem and bY>=3600 or e.time_format~="dynamic"local dy=de and e.volume_control and h.playresx<e.hide_volume_bar_trigger-dt;local dz=du-(dy and 75 or 0)-(de and not e.volume_control and 115 or 0)-(not de and 12 or 0)local dA=80+(X.tc_ms and 50 or 0)+(X.tc_right_rem and 15 or 0)+(dw and 20 or 0)+(dx and 20 or 0)local dB=h.playresx<e.portrait_window_trigger-dt-(dr and 0 or 100)-(df and 0 or 100)-(de and 0 or 100)cP=cM("time_codes")cP.geometry={x=dB and da or dz,y=db-(dB and e.time_codes_centered_height or e.time_codes_height),an=dB and 5 or 4,w=dA,h=e.time_font_size}cP.style=S.time;local dC=d3.w-37;if dj then cP=cM("tog_fullscreen")cP.geometry={x=dC,y=db-35,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=250-dt;dC=dC-45 end;if dk then cP=cM("tog_info")cP.geometry={x=dC,y=db-35,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=300-dt;dC=dC-45 end;if dl then cP=cM("tog_ontop")cP.geometry={x=dC,y=db-35,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=500-dt;dC=dC-45 end;if dm then cP=cM("screenshot")cP.geometry={x=dC,y=db-35,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=600-dt;dC=dC-45 end;if dn then cP=cM("tog_loop")cP.geometry={x=dC,y=db-35,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=600-dt and dn;dC=dC-45 end;if dp then cP=cM("tog_speed")cP.geometry={x=dC,y=db-35,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=600-dt;dC=dC-45 end;if dq then cP=cM("download")cP.geometry={x=dC,y=db-35,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=400-dt;dC=dC-45 end;if e.cache_info then cP=cM("cache_info")cP.geometry={x=dC+7,y=db-35,an=6,w=e.cache_info_speed and 70 or 45,h=24}cP.style=S.cache end end;cZ["modern-image"]=function()local d3={w=h.playresx,h=50}h.video_margins.b=math.max(50,e.fade_alpha)/h.playresy;local d4=0;local d5=h.playresy;h.areas={}aP("input",ap(d4,d5,1,d3.w,d3.h))aP("showhide",0,0,h.playresx,h.playresy)local d6,d7=d3.w,d3.h;local cP,d8;cL("osc_fade_bg","box")cP=cM("osc_fade_bg")cP.geometry={x=d4,y=d5,an=7,w=d6,h=1}cP.style=S.osc_fade_bg;cP.layer=10;cP.alpha[3]=e.fade_transparency_strength;local d9=bn()and(e.window_title or e.window_controls)if(e.window_top_bar=="yes"or not(X.border and X.title_bar)or X.fullscreen)and d9 then cL("window_bar_alpha_bg","box")cP=cM("window_bar_alpha_bg")cP.geometry={x=d4,y=-100,an=7,w=d6,h=-1}cP.style=S.window_fade_bg;cP.layer=10;cP.alpha[3]=e.window_fade_transparency_strength end;local da=d6/2;local db=d5;local di=e.track_nextprev_buttons;local dj=e.fullscreen_button;local dk=e.info_button;local dl=e.ontop_button;local dr=e.playlist_button and(not e.hide_empty_playlist_button or mp.get_property_number("playlist-count",0)>1)local dD=e.zoom_control;if dr then cP=cM("tog_playlist")cP.geometry={x=25,y=db-30,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=250 end;if di then cP=cM("playlist_prev")cP.geometry={x=55-(dr and 0 or 25),y=db-30,an=5,w=30,h=24}cP.style=S.control_2;cP=cM("playlist_next")cP.geometry={x=80-(dr and 0 or 25),y=db-30,an=5,w=30,h=24}cP.style=S.control_2 end;if dD then cP=cM("zoom_out_icon")cP.geometry={x=130-(dr and 0 or 25)-(di and 0 or 70),y=db-30,an=5,w=30,h=24}cP.style=S.control_2;cP=cL("zoom_control_bg","box")cP.visible=h.playresx>=400 and e.zoom_control;cP=cM("zoom_control_bg")cP.geometry={x=145-(dr and 0 or 25)-(di and 0 or 70),y=db-30,an=4,w=80,h=4}cP.layer=13;cP.alpha[1]=128;cP.style=S.volumebar_bg;cP=cM("zoom_control")cP.geometry={x=145-(dr and 0 or 25)-(di and 0 or 70),y=db-30,an=4,w=80,h=10}cP.style=S.volumebar_fg;cP.slider.gap=3;cP.slider.tooltip_style=S.tooltip;cP.slider.tooltip_an=2;cP=cM("zoom_in_icon")cP.geometry={x=240-(dr and 0 or 25)-(di and 0 or 70),y=db-30,an=5,w=30,h=24}cP.style=S.control_2 end;if dj then cP=cM("tog_fullscreen")cP.geometry={x=d3.w-37,y=db-30,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=250 end;if dk then cP=cM("tog_info")cP.geometry={x=d3.w-82+(dj and 0 or 45),y=db-30,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=300 end;if dl then cP=cM("tog_ontop")cP.geometry={x=d3.w-127+(dk and 0 or 45)+(dj and 0 or 45),y=db-30,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=500 end;if e.download_button then cP=cM("download")cP.geometry={x=d3.w-172+(dl and 0 or 45)+(dk and 0 or 45)+(dj and 0 or 45),y=db-30,an=5,w=24,h=24}cP.style=S.control_3;cP.visible=h.playresx>=400 end end;local function dE(dF)if not mp.get_property_native("sid")then return end;local dG=X.fullscreen and e.scalefullscreen or e.scalewindowed;if dF and e.raise_subtitles and X.osc_visible==true then local a9,aa=mp.get_osd_size()if aa>0 then local dH=e.raise_subtitle_amount;if dG>1 then dH=dH*(1+(dG-1)*0.2)elseif dG<1 then dH=dH*(0.8+(dG-0.5)*0.5)end;local dI=dH/h.playresy*100;if X.user_subpos>=100-dI then local dJ=math.floor((h.playresy-dH)/h.playresy*100)if dJ<0 then dJ=X.user_subpos end;X.osc_adjusted_subpos=dJ;mp.set_property_number("sub-pos",dJ)else X.osc_adjusted_subpos=nil end end elseif e.raise_subtitles then if X.user_subpos then mp.set_property_number("sub-pos",X.user_subpos)end;X.osc_adjusted_subpos=nil end end;local function dK()local dL=mp.get_property_native("current-tracks/video")if dL and dL.image and not dL.albumart then X.is_image=true else X.is_image=false end end;local function dM(dF)if X.osc_visible~=dF then X.osc_visible=dF;b9()dE(true)end;bc()end;local function dN(cK)if cK~=""and cK~="ignore"then return function()mp.command(cK)end end end;local function dO()b.debug("osc_init")local dP=720;local H,dQ,dR=mp.get_osd_size()local dG;if X.fullscreen then dG=e.scalefullscreen else dG=e.scalewindowed end;local dS;if e.vidscale=="auto"then dS=mp.get_property_native("osd-scale-by-window")else dS=e.vidscale=="yes"end;if dS then h.unscaled_y=dP else h.unscaled_y=dQ end;h.playresy=h.unscaled_y/dG;if dR>0 then h.display_aspect=dR end;h.playresx=h.playresy*h.display_aspect;X.active_element=nil;bo={}local dT=mp.get_property_number("playlist-count",0)local dU=dT>1;local dV=mp.get_property_number("playlist-pos",0)+1;local dW=mp.get_property_number("chapters",0)>0;local dX=mp.get_property("loop-playlist","no")local dY=e.jump_buttons and 0 or 100;local dZ=e.chapter_skip_buttons and 0 or 100;local dt=(e.chapter_skip_buttons and 0 or 100)+(e.jump_buttons and 0 or 100)local d_=(L==0 or not mp.get_property_native("aid"))and 100 or 0;local e0=(M==0 or not mp.get_property_native("sid"))and 100 or 0;local e1=not dU and 100 or 0;local e2;e2=cL("close","button")e2.content=w.window.close;e2.eventresponder["mbtn_left_up"]=function()mp.commandv("quit")end;e2=cL("minimize","button")e2.content=w.window.minimize;e2.eventresponder["mbtn_left_up"]=function()mp.commandv("cycle","window-minimized")end;e2=cL("maximize","button")e2.content=(X.maximized or X.fullscreen)and w.window.unmaximize or w.window.maximize;e2.eventresponder["mbtn_left_up"]=function()mp.commandv("cycle",X.fullscreen and"fullscreen"or"window-maximized")end;e2=cL("windowtitle","button")e2.content=function()local e3=mp.command_native({"expand-text",e.windowcontrols_title})or""e3=e3:gsub("\n"," ")return e3~=""and mp.command_native({"escape-ass",e3})or"mpv"end;e2=cL("title","button")e2.visible=e.show_title;e2.content=function()local e3=X.forced_title or mp.command_native({"expand-text",e.title})e3=e3:gsub("\n"," ")return e3~=""and mp.command_native({"escape-ass",e3})or"mpv"end;e2.eventresponder["mbtn_left_up"]=dN(e.title_mbtn_left_command)e2.eventresponder["mbtn_right_up"]=dN(e.title_mbtn_right_command)e2.eventresponder["shift+mbtn_left_down"]=dN(e.title_mbtn_mid_command)e2=cL("chapter_title","button")e2.visible=mp.get_property_number("chapter",-1)>=0;e2.content=function()local d1=mp.get_property_number("chapter",-1)if e.chapter_fmt=="no"or d1<0 then return""end;local e4=mp.get_property_native("chapter-list",{})local e5=e4[d1+1]local e6=e5 and e5.title~=""and e5.title or string.format("%s: %d/%d",z.chapter,d1+1,#e4)e6=mp.command_native({"escape-ass",e6})if J.disabled and not e.show_title and X.forced_title then e6=X.forced_title end;return string.format(e.chapter_fmt,e6)end;e2.eventresponder["mbtn_left_up"]=dN(e.chapter_title_mbtn_left_command)e2.eventresponder["mbtn_right_up"]=dN(e.chapter_title_mbtn_right_command)e2=cL("playlist_prev","button")e2.visible=h.playresx>=(X.is_image and 300 or 500)-dY-dZ*(dY==0 and 1 or 10)e2.content=w.previous;e2.enabled=dV>1 or dX~="no"or C(e.buttons_always_active,"playlist_prev")e2.eventresponder["mbtn_left_up"]=dN(e.playlist_prev_mbtn_left_command)e2.eventresponder["mbtn_right_up"]=dN(e.playlist_prev_mbtn_right_command)e2.eventresponder["shift+mbtn_left_down"]=dN(e.playlist_prev_mbtn_mid_command)e2=cL("playlist_next","button")e2.visible=h.playresx>=(X.is_image and 300 or 500)-dY-dZ*(dY==0 and 1 or 10)e2.content=w.next;e2.enabled=dU and dV<dT or dX~="no"or C(e.buttons_always_active,"playlist_next")e2.eventresponder["mbtn_left_up"]=dN(e.playlist_next_mbtn_left_command)e2.eventresponder["mbtn_right_up"]=dN(e.playlist_next_mbtn_right_command)e2.eventresponder["shift+mbtn_left_down"]=dN(e.playlist_next_mbtn_mid_command)e2=cL("play_pause","button")e2.content=function()if mp.get_property("eof-reached")=="yes"then return w.replay elseif mp.get_property("pause")=="yes"and not X.playing_and_seeking then return w.play else return w.pause end end;e2.eventresponder["mbtn_left_up"]=function()if mp.get_property("eof-reached")=="yes"then mp.commandv("seek",0,"absolute-percent")mp.commandv("set","pause","no")else mp.commandv("cycle","pause")end end;e2.eventresponder["mbtn_right_down"]=function()if e.loop_in_pause then mp.command("show-text '"..(X.looping and z.loop_disable or z.loop_enable).."'")X.looping=not X.looping;mp.set_property_native("loop-file",X.looping)end end;local e7=e.jump_amount;local e8=e.jump_more_amount;local e9=e.jump_mode;local ea=e.jump_icon_number and w.jump[e7]or w.jump.default;e2=cL("jump_backward","button")e2.softrepeat=e.jump_softrepeat==true;e2.content=ea[1]e2.eventresponder["mbtn_left_down"]=function()mp.commandv("seek",-e7,e9)end;e2.eventresponder["mbtn_right_down"]=function()mp.commandv("seek",-e8,e9)end;e2.eventresponder["shift+mbtn_left_down"]=function()mp.commandv("frame-back-step")end;e2=cL("jump_forward","button")e2.softrepeat=e.jump_softrepeat==true;e2.content=ea[2]e2.eventresponder["mbtn_left_down"]=function()mp.commandv("seek",e7,e9)end;e2.eventresponder["mbtn_right_down"]=function()mp.commandv("seek",e8,e9)end;e2.eventresponder["shift+mbtn_left_down"]=function()mp.commandv("frame-step")end;e2=cL("chapter_backward","button")e2.visible=h.playresx>=400-dY*10;e2.softrepeat=e.chapter_softrepeat==true;e2.content=w.rewind;e2.enabled=dW;e2.eventresponder["mbtn_left_down"]=dN(e.chapter_prev_mbtn_left_command)e2.eventresponder["mbtn_right_down"]=dN(e.chapter_prev_mbtn_right_command)e2.eventresponder["shift+mbtn_left_down"]=dN(e.chapter_prev_mbtn_mid_command)e2.eventresponder["shift+mbtn_right_down"]=function()mp.commandv("seek",-e8,e9)end;e2=cL("chapter_forward","button")e2.visible=h.playresx>=400-dY*10;e2.softrepeat=e.chapter_softrepeat==true;e2.content=w.forward;e2.enabled=dW;e2.eventresponder["mbtn_left_down"]=dN(e.chapter_next_mbtn_left_command)e2.eventresponder["mbtn_right_down"]=dN(e.chapter_next_mbtn_right_command)e2.eventresponder["shift+mbtn_left_down"]=dN(e.chapter_next_mbtn_mid_command)e2.eventresponder["shift+mbtn_right_down"]=function()mp.commandv("seek",e8,e9)end;bi()local eb=550-dt;e2=cL("tog_playlist","button")e2.enabled=dU or not e.gray_empty_playlist_button;e2.off=not dU and e.gray_empty_playlist_button;e2.visible=h.playresx>=(X.is_image and 250 or eb)-dt;e2.content=w.playlist;e2.tooltip_style=S.tooltip;e2.tooltipF=e.tooltip_hints and z.menu or""e2.nothingavailable=z.no_playlist;e2.eventresponder["mbtn_left_up"]=dN(e.playlist_mbtn_left_command)e2.eventresponder["mbtn_right_up"]=dN(e.playlist_mbtn_right_command)eb=eb+(e2.enabled and 100 or 0)e2=cL("audio_track","button")e2.enabled=L>0;e2.off=L==0 or not mp.get_property_native("aid")e2.visible=h.playresx>=eb;e2.content=w.audio;e2.tooltip_style=S.tooltip;e2.tooltipF=function()local ec=mp.get_property("current-tracks/audio/title")or mp.get_property("current-tracks/audio/lang")or z.na;return z.audio.." "..mp.get_property_number("aid","-").."/"..L.." ["..ec.."]"end;e2.nothingavailable=z.no_audio;e2.eventresponder["mbtn_left_up"]=dN(e.audio_track_mbtn_left_command)e2.eventresponder["mbtn_right_up"]=dN(e.audio_track_mbtn_right_command)e2.eventresponder["shift+mbtn_left_down"]=dN(e.audio_track_mbtn_mid_command)e2.eventresponder["wheel_down_press"]=dN(e.audio_track_wheel_down_command)e2.eventresponder["wheel_up_press"]=dN(e.audio_track_wheel_up_command)eb=eb+(e2.enabled and 100 or 0)e2=cL("sub_track","button")e2.enabled=M>0;e2.off=M==0 or not mp.get_property_native("sid")e2.visible=h.playresx>=eb-dt;e2.content=w.subtitle;e2.tooltip_style=S.tooltip;e2.tooltipF=function()local ec=mp.get_property("current-tracks/sub/title")or mp.get_property("current-tracks/sub/lang")or z.na;return z.subtitle.." "..mp.get_property_number("sid","-").."/"..M.." ["..ec.."]"end;e2.nothingavailable=z.no_subs;e2.eventresponder["mbtn_left_up"]=dN(e.sub_track_mbtn_left_command)e2.eventresponder["mbtn_right_up"]=dN(e.sub_track_mbtn_right_command)e2.eventresponder["shift+mbtn_left_down"]=dN(e.sub_track_mbtn_mid_command)e2.eventresponder["wheel_down_press"]=dN(e.sub_track_wheel_down_command)e2.eventresponder["wheel_up_press"]=dN(e.sub_track_wheel_up_command)eb=eb+(e2.enabled and 100 or 0)local ed=e0+e1;e2=cL("vol_ctrl","button")e2.enabled=L>0;e2.off=L==0;e2.visible=h.playresx>=900-ed-dt and e.volume_control;e2.content=function()local bm=mp.get_property_number("volume",0)if X.mute then return w.volume_mute else if bm>=75 then return w.volume_high elseif bm>=25 then return w.volume_low else return w.volume_quiet end end end;e2.tooltip_style=S.tooltip;e2.tooltipF=function()local bm=mp.get_property_number("volume",0)or 0;bm=bm%1==0 and string.format("%.0f",bm)or string.format("%.1f",bm)return bm end;e2.eventresponder["mbtn_left_up"]=dN(e.vol_ctrl_mbtn_left_command)e2.eventresponder["mbtn_right_up"]=dN(e.vol_ctrl_mbtn_right_command)e2.eventresponder["wheel_up_press"]=dN(e.vol_ctrl_wheel_up_command)e2.eventresponder["wheel_down_press"]=dN(e.vol_ctrl_wheel_down_command)local ee=mp.get_property_number("volume-max")>0 and mp.get_property_number("volume-max")or 100;e2=cL("volumebar","slider")e2.visible=h.playresx>=1150-dt and e.volume_control;e2.enabled=L>0;e2.slider={min={value=0},max={value=ee}}e2.slider.markerF=function()return{}end;e2.slider.seekRangesF=function()return nil end;e2.slider.posF=function()local bm=mp.get_property_number("volume")if e.volume_control=="logarithmic"then return math.sqrt(bm*100)else return bm end end;e2.slider.tooltipF=function(bI)return L>0 and bk(bI)or""end;e2.eventresponder["mouse_move"]=function(av)local bI=aL(av)local ef=bk(bI)if av.state.lastseek==nil or av.state.lastseek~=ef then mp.commandv("osd-msg","set","volume",ef)av.state.lastseek=ef end end;e2.eventresponder["mbtn_left_down"]=function(av)local bI=aL(av)mp.commandv("osd-msg","set","volume",bk(bI))end;e2.eventresponder["reset"]=function(av)av.state.lastseek=nil end;e2.eventresponder["wheel_up_press"]=dN(e.vol_ctrl_wheel_up_command)e2.eventresponder["wheel_down_press"]=dN(e.vol_ctrl_wheel_down_command)local eg=mp.get_property_number("video-zoom")e2=cL("zoom_out_icon","button")e2.visible=h.playresx>=400;e2.content=w.zoom_out;e2.tooltip_style=S.tooltip;e2.tooltipF=e.tooltip_hints and z.zoom_out or""e2.eventresponder["mbtn_left_up"]=function()mp.commandv("osd-msg","set","video-zoom",math.max(e.zoom_out_min,eg-0.05))end;e2.eventresponder["mbtn_right_up"]=function()mp.commandv("osd-msg","set","video-zoom",0)end;e2.eventresponder["wheel_up_press"]=function()mp.commandv("osd-msg","set","video-zoom",math.min(e.zoom_in_max,eg+0.05))end;e2.eventresponder["wheel_down_press"]=function()mp.commandv("osd-msg","set","video-zoom",math.max(e.zoom_out_min,eg-0.05))end;e2=cL("zoom_control","slider")e2.slider={min={value=e.zoom_out_min},max={value=e.zoom_in_max}}e2.visible=h.playresx>=400 and e.zoom_control and X.is_image;e2.slider.markerF=function()return{}end;e2.slider.seekRangesF=function()return nil end;e2.slider.posF=function()return mp.get_property_number("video-zoom")end;e2.slider.tooltipF=function(bI)return string.format("%.3f",bI):gsub("%.?0*$","")end;e2.eventresponder["mouse_move"]=function(av)local bI=aL(av)if av.state.lastseek==nil or av.state.lastseek~=bI then mp.commandv("osd-msg","set","video-zoom",bI)av.state.lastseek=bI end end;e2.eventresponder["mbtn_left_down"]=function(av)mp.commandv("osd-msg","set","video-zoom",aL(av))end;e2.eventresponder["reset"]=function(av)av.state.lastseek=nil end;e2.eventresponder["mbtn_right_up"]=function()mp.commandv("osd-msg","set","video-zoom",0)end;e2.eventresponder["wheel_up_press"]=function()mp.commandv("osd-msg","set","video-zoom",math.min(e.zoom_in_max,eg+0.05))end;e2.eventresponder["wheel_down_press"]=function()mp.commandv("osd-msg","set","video-zoom",math.max(e.zoom_out_min,eg-0.05))end;e2=cL("zoom_in_icon","button")e2.visible=h.playresx>=400;e2.content=w.zoom_in;e2.tooltip_style=S.tooltip;e2.tooltipF=e.tooltip_hints and z.zoom_in or""e2.eventresponder["mbtn_left_up"]=function()mp.commandv("osd-msg","set","video-zoom",math.min(e.zoom_in_max,eg+0.05))end;e2.eventresponder["mbtn_right_up"]=function()mp.commandv("osd-msg","set","video-zoom",0)end;e2.eventresponder["wheel_up_press"]=function()mp.commandv("osd-msg","set","video-zoom",math.min(e.zoom_in_max,eg+0.05))end;e2.eventresponder["wheel_down_press"]=function()mp.commandv("osd-msg","set","video-zoom",math.max(e.zoom_out_min,eg-0.05))end;eb=550-dt;e2=cL("tog_fullscreen","button")e2.content=function()return X.fullscreen and w.fullscreen_exit or w.fullscreen end;e2.visible=h.playresx>=eb;e2.eventresponder["mbtn_left_up"]=dN(e.fullscreen_mbtn_left_command)e2.eventresponder["mbtn_right_up"]=dN(e.fullscreen_mbtn_right_command)eb=eb+(e.fullscreen_button and 100 or 0)e2=cL("tog_info","button")e2.content=w.info;e2.tooltip_style=S.tooltip;e2.tooltipF=e.tooltip_hints and z.stats_info or""e2.visible=h.playresx>=eb;e2.eventresponder["mbtn_left_up"]=dN(e.info_mbtn_left_command)eb=eb+(e.info_button and 100 or 0)e2=cL("tog_ontop","button")e2.content=function()return mp.get_property("ontop")=="no"and w.ontop_on or w.ontop_off end;e2.tooltip_style=S.tooltip;e2.tooltipF=function()return e.tooltip_hints and(mp.get_property("ontop")=="no"and z.ontop or z.ontop_disable)or""end;e2.visible=h.playresx>=eb;e2.eventresponder["mbtn_left_up"]=function()mp.commandv("cycle","ontop")if X.initialborder=="yes"then if mp.get_property("ontop")=="yes"then mp.commandv("set","border","no")else mp.commandv("set","border","yes")end end end;e2.eventresponder["mbtn_right_up"]=function()mp.commandv("cycle","ontop")if mp.get_property("border")=="no"then mp.commandv("set","border","yes")end end;eb=eb+(e.ontop_button and 100 or 0)e2=cL("screenshot","button")e2.content=w.screenshot;e2.tooltip_style=S.tooltip;e2.tooltipF=e.tooltip_hints and z.screenshot or""e2.visible=h.playresx>=eb;e2.eventresponder["mbtn_left_up"]=function()local eh=mp.get_property("sub-pos")if e.screenshot_flag=="subtitles"or e.screenshot_flag=="subtitles+each-frame"then mp.commandv("set","sub-pos",100)end;mp.commandv("osd-msg","screenshot",e.screenshot_flag)mp.commandv("set","sub-pos",eh)end;eb=eb+(e.screenshot_button and 100 or 0)e2=cL("tog_loop","button")e2.content=function()return X.looping and w.loop_on or w.loop_off end;e2.visible=h.playresx>=eb;e2.tooltip_style=S.tooltip;e2.tooltipF=function()return e.tooltip_hints and(X.looping and z.loop_disable or z.loop_enable)or""end;e2.eventresponder["mbtn_left_up"]=function()mp.command("show-text '"..(X.looping and z.loop_disable or z.loop_enable).."'")X.looping=not X.looping;mp.set_property_native("loop-file",X.looping)end;eb=eb+(e.loop_button and 100 or 0)e2=cL("tog_speed","button")e2.content=w.speed;e2.visible=h.playresx>=eb;e2.tooltip_style=S.tooltip;e2.tooltipF=e.tooltip_hints and z.speed_control or""e2.eventresponder["mbtn_left_up"]=function()mp.commandv("osd-msg","set","speed",math.min(100,mp.get_property_number("speed")+e.speed_button_click))end;e2.eventresponder["mbtn_right_up"]=function()mp.commandv("osd-msg","set","speed",1)end;e2.eventresponder["wheel_up_press"]=function()mp.commandv("osd-msg","set","speed",math.min(100,mp.get_property_number("speed")+e.speed_button_scroll))end;e2.eventresponder["wheel_down_press"]=function()mp.commandv("osd-msg","set","speed",math.max(0.25,mp.get_property_number("speed")-e.speed_button_scroll))end;eb=eb+(e.speed_button and 100 or 0)e2=cL("download","button")e2.content=function()return X.downloading and w.downloading or w.download end;e2.visible=h.playresx>=eb and X.is_URL;e2.tooltip_style=S.tooltip;e2.tooltipF=function()return X.downloading and z.downloading.."..."or z.download.." ("..X.file_size_normalized..")"end;e2.eventresponder["mbtn_left_up"]=function()local ei=mp.command_native({"expand-path",e.download_path})if X.downloaded_once then mp.commandv("show-text",z.downloaded)elseif X.downloading then mp.commandv("show-text",z.download_in_progress)else mp.commandv("show-text",z.downloading.."...")X.downloading=true;local cI=mp.get_property("file-local-options/ytdl-format")or mp.get_property("ytdl-format")or""local cJ=cI and cI~=""and"-f "..cI or"-f ".."bestvideo+bestaudio/best"local cK={"yt-dlp",X.is_image and""or cJ,X.is_image and""or"--remux",X.is_image and""or"mp4","--add-metadata","--embed-subs","-o","%(title)s.%(ext)s","-P",ei,X.url_path}local ej=cE(cK,cz)end end;eb=eb+(e.download_button and 100 or 0)e2=cL("cache_info","button")e2.visible=h.playresx>=eb;e2.content=function()if not b8()then return""end;local ek=X.cache_state["cache-duration"]local el=math.min(X.dmx_cache*0.05,5)if ek and math.abs(ek-X.dmx_cache)>=el then X.dmx_cache=ek else ek=X.dmx_cache end;local aF=math.floor(ek/60)local em=math.floor(ek%60)local en=aF>0 and string.format("%sm%02.0fs",aF,em)or string.format("%3.0fs",em)local eo=X.cache_state["raw-input-rate"]or 0;local ep=d.format_bytes_humanized(eo)local eq,er=ep:match("([%d%.]+)%s*(%S+)")local es=X.buffering and z.buffering..": "..mp.get_property("cache-buffering-state").."%"or en;local et=string.format("%8s %4s/s",eq,er)return e.cache_info_speed and es.."\\N"..et or es end;e2.tooltip_style=S.tooltip;e2.tooltipF=e.tooltip_hints and b8()and z.cache or""e2.eventresponder["mbtn_left_up"]=function()mp.command("script-binding stats/display-page-3")end;e2=cL("seekbar","slider")e2.enabled=mp.get_property("percent-pos")~=nil;e2.thumbnailable=true;X.slider_element=e2.enabled and e2 or nil;e2.slider.markerF=function()local eu=mp.get_property_number("duration")if eu~=nil then local e4=mp.get_property_native("chapter-list",{})local bx={}for bE=1,#e4 do bx[bE]=e4[bE].time/eu*100 end;return bx else return{}end end;e2.slider.posF=function()if mp.get_property_bool("eof-reached")then return 100 end;return mp.get_property_number("percent-pos")end;e2.slider.tooltipF=function(bI)X.touchingprogressbar=true;local eu=mp.get_property_number("duration")if eu~=nil and bI~=nil then local bC=eu*bI/100;local ev=mp.format_time(bC)if bC<3600 and e.time_format~="fixed"then ev=ev:gsub("^00:","")end;return ev else return""end end;e2.slider.seekRangesF=function()if not e.seekrange or not b8()then return nil end;local eu=mp.get_property_number("duration")if eu==nil or eu<=0 then return nil end;local ew={}for H,bQ in pairs(X.cache_state["seekable-ranges"])do ew[#ew+1]={["start"]=100*bQ["start"]/eu,["end"]=100*bQ["end"]/eu}end;return ew end;e2.eventresponder["mouse_move"]=function(av)if not av.state.mbtnleft then return end;X.playing_and_seeking=true;if mp.get_property("pause")=="no"and e.mouse_seek_pause then mp.commandv("cycle","pause")end;local ex=aL(av)if av.state.lastseek==nil or av.state.lastseek~=ex then local ey="absolute-percent"if not e.seekbarkeyframes then ey=ey.."+exact"end;mp.commandv("seek",ex,ey)av.state.lastseek=ex end end;e2.eventresponder["mbtn_left_down"]=function(av)av.state.mbtnleft=true;mp.commandv("seek",aL(av),"absolute-percent+exact")end;e2.eventresponder["shift+mbtn_left_down"]=function(av)av.state.mbtnleft=true;mp.commandv("seek",aL(av),"absolute-percent")end;e2.eventresponder["mbtn_left_up"]=function(av)av.state.mbtnleft=false end;e2.eventresponder["mbtn_right_down"]=function(av)local ez;local bI=aL(av)local eA=math.huge;for cv,by in ipairs(av.slider.markerF())do if math.abs(bI-by)<eA then eA=math.abs(bI-by)ez=cv end end;if ez then mp.set_property("chapter",ez-1)end end;e2.eventresponder["reset"]=function(av)av.state.lastseek=nil;if X.playing_and_seeking then if mp.get_property("eof-reached")=="no"and e.mouse_seek_pause then mp.commandv("cycle","pause")end;X.playing_and_seeking=false end end;e2.eventresponder["wheel_up_press"]=function()mp.commandv("seek",10)end;e2.eventresponder["wheel_down_press"]=function()mp.commandv("seek",-10)end;e2=cL("persistentseekbar","slider")e2.enabled=mp.get_property("percent-pos")~=nil;X.slider_element=e2.enabled and e2 or nil;e2.slider.markerF=function()return{}end;e2.slider.posF=function()if mp.get_property_bool("eof-reached")then return 100 end;return mp.get_property_number("percent-pos")end;e2.slider.tooltipF=function()return""end;e2.slider.seekRangesF=function()if e.persistentbuffer then if not e.seekrange then return nil end;local eB=X.cache_state;if not eB then return nil end;local eu=mp.get_property_number("duration")if eu==nil or eu<=0 then return nil end;local eC=eB["seekable-ranges"]if#eC==0 then return nil end;local ew={}for H,bQ in pairs(eC)do ew[#ew+1]={["start"]=100*bQ["start"]/eu,["end"]=100*bQ["end"]/eu}end;return ew end;return nil end;local function eD(eE)if not eE then return"--:--"end;local eF=math.floor(eE/3600)local eG=math.floor(eE%3600/60)local eH=math.floor(eE%60)local eI=X.tc_ms and math.floor(eE%1*1000)or nil;local eJ=e.time_format=="fixed"local eK=(eF>0 or eJ)and"%02d:%02d:%02d.%03d"or"%02d:%02d.%03d"local eL=(eF>0 or eJ)and"%02d:%02d:%02d"or"%02d:%02d"if X.tc_ms then return string.format(eK,(eF>0 or eJ)and eF or eG,(eF>0 or eJ)and eG or eH,(eF>0 or eJ)and eH or eI,(eF>0 or eJ)and eI or nil)else return string.format(eL,(eF>0 or eJ)and eF or eG,(eF>0 or eJ)and eG or eH,(eF>0 or eJ)and eH or nil)end end;local eM=d_+e0+e1;e2=cL("time_codes","button")e2.visible=mp.get_property_number("duration",0)>0;e2.content=function()local eN=mp.get_property_number("playback-time",0)if e.time_format~="fixed"and eN then local eO=eN>=3600;if eO~=X.playtime_hour_force_init then bf()X.playtime_hour_force_init=eO;X.playtime_nohour_force_init=not eO end end;local eu=mp.get_property_number("duration",0)if eu<=0 then return"--:--"end;local eP=X.tc_right_rem and mp.get_property_number("playtime-remaining",0)or eu;local eQ=X.tc_right_rem and(e.unicodeminus and P or"-")or""return eD(eN).." / "..eQ..eD(eP)end;e2.eventresponder["mbtn_left_up"]=function()X.tc_right_rem=not X.tc_right_rem end;e2.eventresponder["mbtn_right_up"]=function()X.tc_ms=not X.tc_ms;bf()end;if X.is_image then cZ["modern-image"]()else cZ["modern"]()end;if bn()then cN()end;bp()b9()end;local function eR()if not X.enabled then return end;b.trace("show_osc")X.showtime=mp.get_time()if e.fadeduration<=0 then dM(true)elseif e.fadein then if not X.osc_visible then X.anitype="in"bc()end else dM(true)X.anitype=nil end end;local function eS()b.trace("hide_osc")if J.width~=0 and J.height~=0 then mp.commandv("script-message-to","thumbfast","clear")end;if not X.enabled then X.osc_visible=false;dE(false)bh()elseif e.fadeduration>0 then if X.osc_visible then X.anitype="out"bc()end else dM(false)end end;local function eT(H,eU)X.paused=eU;bc()end;local function eB(H,eV)X.cache_state=eV;bc()end;local function eW()X.touchtime=nil;if b6()>=0 and b7()<=0 then local eX=mp.get_time()-X.showtime;if eX>=b6()/1000 then eS()end end;X.last_mouseX,X.last_mouseY=nil,nil;X.mouse_in_window=false end;local function eY()X.touchtime=mp.get_time()end;local function eZ()X.showtime=mp.get_time()end;local function e_(av,f0)return av and av.eventresponder and av.eventresponder[f0]end;local function f1(f2,f3)local f0=string.format("%s%s",f2,f3 and"_"..f3 or"")if f3=="down"or f3=="press"then eZ()for bE=1,#bo do if aD(bo[bE])and bo[bE].eventresponder and(bo[bE].eventresponder[f2 .."_up"]or bo[bE].eventresponder[f0])then if f3=="down"then X.active_element=bE;X.active_event_source=f2 end;if e_(bo[bE],f0)then bo[bE].eventresponder[f0](bo[bE])end end end elseif f3=="up"then if bo[X.active_element]then local bE=X.active_element;if bE==0 then elseif e_(bo[bE],f0)and aD(bo[bE])then bo[bE].eventresponder[f0](bo[bE])end;if e_(bo[bE],"reset")then bo[bE].eventresponder["reset"](bo[bE])end end;X.active_element=nil;X.mouse_down_counter=0 elseif f2=="mouse_move"then X.mouse_in_window=true;local f4,f5=ab()if e.minmousemove==0 or X.last_mouseX~=nil and X.last_mouseY~=nil and(math.abs(f4-X.last_mouseX)>=e.minmousemove or math.abs(f5-X.last_mouseY)>=e.minmousemove)then if e.bottomhover then local f6=bn()and(e.window_title or e.window_controls)if f5>h.playresy-(e.bottomhover_zone or 130)or(e.window_top_bar=="yes"or not(X.border and X.title_bar)or X.fullscreen)and(f5<40 and f6)then eR()else X.touchtime=nil;if b6()>=0 and b7()<=0 then local eX=mp.get_time()-X.showtime;if eX>=b6()/1000 then eS()end end end else eR()end end;X.last_mouseX,X.last_mouseY=f4,f5;local bE=X.active_element;if e_(bo[bE],f0)then bo[bE].eventresponder[f0](bo[bE])end end;bc()end;local function f7()if X.enabled then if not X.showhide_enabled then mp.enable_key_bindings("showhide","allow-vo-dragging+allow-hide-cursor")mp.enable_key_bindings("showhide_wc","allow-vo-dragging+allow-hide-cursor")end;X.showhide_enabled=true end end;local function f8(f9)X.enabled=f9;if f9 then f7()else eS()if X.showhide_enabled then mp.disable_key_bindings("showhide")mp.disable_key_bindings("showhide_wc")end;X.showhide_enabled=false end end;local function fa()b.trace("rendering")local fb,fc=mp.get_osd_size()local f4,f5=ab()local bd=mp.get_time()if X.screen_sizeX~=fb or X.screen_sizeY~=fc then bg()X.screen_sizeX=fb;X.screen_sizeY=fc end;if X.active_element then bc()elseif X.initREQ then dO()X.initREQ=false;if(X.last_mouseX==nil or X.last_mouseY==nil)and not(f4==nil or f5==nil)then X.last_mouseX,X.last_mouseY=f4,f5 end end;if X.anitype~=nil then if X.anistart==nil then X.anistart=bd end;if bd<X.anistart+e.fadeduration/1000 then if X.anitype=="in"then dM(true)X.animation=al(X.anistart,X.anistart+e.fadeduration/1000,255,0,bd)elseif X.anitype=="out"then X.animation=al(X.anistart,X.anistart+e.fadeduration/1000,0,255,bd)end else if X.anitype=="out"then dM(false)end;_()end else _()end;for H,fd in pairs(h.areas["showhide"])do ag(fd.x1,fd.y1,fd.x2,fd.y2,"showhide")end;if h.areas["showhide_wc"]then for H,fd in pairs(h.areas["showhide_wc"])do ag(fd.x1,fd.y1,fd.x2,fd.y2,"showhide_wc")end else ag(0,0,0,0,"showhide_wc")end;f7()local fe=false;for H,fd in ipairs(h.areas["input"])do if X.osc_visible then ag(fd.x1,fd.y1,fd.x2,fd.y2,"input")end;if X.osc_visible~=X.input_enabled then if X.osc_visible then mp.enable_key_bindings("input")else mp.disable_key_bindings("input")end;X.input_enabled=X.osc_visible end;if aw(fd.x1,fd.y1,fd.x2,fd.y2)and e.osc_keep_with_cursor then fe=true end end;if h.areas["window-controls"]then for H,fd in ipairs(h.areas["window-controls"])do if X.osc_visible then ag(fd.x1,fd.y1,fd.x2,fd.y2,"window-controls")mp.enable_key_bindings("window-controls")else mp.disable_key_bindings("window-controls")end;if aw(fd.x1,fd.y1,fd.x2,fd.y2)and e.osc_keep_with_cursor then fe=true end end end;if h.areas["window-controls-title"]then for H,fd in ipairs(h.areas["window-controls-title"])do if X.osc_visible then ag(fd.x1,fd.y1,fd.x2,fd.y2,"window-controls-title")end;if X.osc_visible~=X.windowcontrols_title then if X.osc_visible then mp.enable_key_bindings("window-controls-title","allow-vo-dragging")else mp.disable_key_bindings("window-controls-title","allow-vo-dragging")end;X.windowcontrols_title=X.osc_visible end;if aw(fd.x1,fd.y1,fd.x2,fd.y2)and e.osc_keep_with_cursor then fe=true end end end;if X.showtime~=nil and b6()>=0 then local be=X.showtime+b6()/1000-bd;if be<=0 and b7()<=0 then if X.active_element==nil and not fe then eS()end else if not X.hide_timer then X.hide_timer=mp.add_timeout(0,bb)end;X.hide_timer.timeout=be;X.hide_timer:kill()X.hide_timer:resume()end end;local aT=a.ass_new()if X.osc_visible then bU(aT)end;if e.persistentprogress or X.persistent_progress_toggle then cq(aT)end;a0(h.playresy*h.display_aspect,h.playresy,aT.text,1000)end;bb=function()if X.marginsREQ==true then b9()X.marginsREQ=false end;if not X.enabled then return end;if X.idle then b.trace("idle message")local H,H,dR=mp.get_osd_size()if dR==0 then return end;local dQ=360;local ff=dQ*dR;local fg,fh=(ff-1800/32)/2,140;local fi=("{\\rDefault\\an7\\1a&H00&\\bord0\\shad0\\pos(%f,%f)}"):format(fg,fh)local aT=a.ass_new()if e.idlescreen then for H,fj in ipairs(Y)do aT:new_event()aT:append(fi..fj)end end;if O and e.idlescreen and not e.greenandgrumpy then for H,fj in ipairs(Z)do aT:new_event()aT:append(fi..fj)end end;if e.idlescreen then aT:new_event()aT:pos(ff/2,fh+65)aT:an(8)aT:append(z.idle)end;a0(ff,dQ,aT.text,-1000)if X.showhide_enabled then mp.disable_key_bindings("showhide")mp.disable_key_bindings("showhide_wc")X.showhide_enabled=false end elseif X.fullscreen and e.showfullscreen or not X.fullscreen and e.showwindowed then fa()else bh()end;X.tick_last_time=mp.get_time()if X.anitype~=nil then if not X.idle and(not X.anistart or mp.get_time()<1+X.anistart+e.fadeduration/1000)then bc()else _()end end end;local function fk()bf()end;local fl=false;local function fm()local fn=e.livemarkers and(mp.get_property_number("chapters",0)or 0)>0 and true or false;if fn~=fl then if fn then mp.observe_property("duration","native",fk)else mp.unobserve_property(fk)end;fl=fn end end;local function fo(H,fp)if not fp or not e.tick_delay_follow_display_fps then K=e.tick_delay;return end;K=1/fp end;mp.register_event("file-loaded",function()dK()X.new_file_flag=true;X.file_size_normalized="Approximating size..."cH()if e.automatickeyframemode then if mp.get_property_number("duration",0)>e.automatickeyframelimit then e.seekbarkeyframes=true else e.seekbarkeyframes=false end end;if e.osc_on_start then eR()end end)mp.register_event("start-file",bf)mp.observe_property("track-list","native",bf)mp.observe_property("playlist-count","native",bf)mp.observe_property("playlist-pos","native",bf)mp.observe_property("chapter-list","native",function(H,D)D=D or{}table.sort(D,function(bs,ao)return bs.time<ao.time end)X.chapter_list=D;fm()bf()end)mp.observe_property("seeking","native",function(H,fq)if e.seek_resets_hidetimeout then eZ()end;if X.new_file_flag then X.new_file_flag=false;return end;if fq and e.osc_on_seek then mp.register_event("seek",eR)else mp.unregister_event(eR)end end)mp.observe_property("fullscreen","bool",function(H,am)X.fullscreen=am;X.marginsREQ=true;dE(X.osc_visible)bg()end)mp.observe_property("border","bool",function(H,am)X.border=am;bg()end)mp.observe_property("title-bar","bool",function(H,am)X.title_bar=am;bg()end)mp.observe_property("window-maximized","bool",function(H,am)X.maximized=am;bg()end)mp.observe_property("idle-active","bool",function(H,am)X.idle=am;bc()end)mp.observe_property("display-fps","number",fo)mp.observe_property("demuxer-cache-state","native",eB)mp.observe_property("vo-configured","bool",bc)mp.observe_property("playback-time","number",bc)mp.observe_property("osd-dimensions","native",function()bg()dE(X.osc_visible)end)mp.observe_property("osd-scale-by-window","native",bg)mp.observe_property("touch-pos","native",eY)mp.observe_property("mute","bool",function(H,am)X.mute=am;bc()end)mp.observe_property("paused-for-cache","bool",function(H,am)X.buffering=am end)mp.observe_property("loop-file","bool",function(H,am)if am==nil then X.looping=true else X.looping=false end end)mp.observe_property("sub-pos","native",function(H,g)if g==nil then return end;if X.osc_adjusted_subpos==nil or g~=X.osc_adjusted_subpos then X.user_subpos=g end end)mp.set_key_bindings({{"mouse_move",function()f1("mouse_move",nil)end},{"mouse_leave",eW}},"showhide","force")mp.set_key_bindings({{"mouse_move",function()f1("mouse_move",nil)end},{"mouse_leave",eW}},"showhide_wc","force")f7()mp.set_key_bindings({{"mbtn_left",function()f1("mbtn_left","up")end,function()f1("mbtn_left","down")end},{"shift+mbtn_left",function()f1("shift+mbtn_left","up")end,function()f1("shift+mbtn_left","down")end},{"mbtn_right",function()f1("mbtn_right","up")end,function()f1("mbtn_right","down")end},{"shift+mbtn_right",function(fr)f1("shift+mbtn_right","up")end,function(fr)f1("shift+mbtn_right","down")end},{"mbtn_mid",function()f1("shift+mbtn_left","up")end,function()f1("shift+mbtn_left","down")end},{"wheel_up",function()f1("wheel_up","press")end},{"wheel_down",function()f1("wheel_down","press")end},{"mbtn_left_dbl","ignore"},{"shift+mbtn_left_dbl","ignore"},{"mbtn_right_dbl","ignore"}},"input","force")mp.enable_key_bindings("input")mp.set_key_bindings({{"mbtn_left",function()f1("mbtn_left","up")end,function()f1("mbtn_left","down")end}},"window-controls","force")mp.enable_key_bindings("window-controls")local function fs(am)if X.enabled then if am then eR()else eS()end end end;local function ft(fu,fv)if fu=="cycle"then for cv,fw in ipairs(X.visibility_modes)do if cv==#X.visibility_modes then fu=X.visibility_modes[1]break elseif e.visibility==fw then fu=X.visibility_modes[cv+1]break end end end;if fu=="auto"then fs(false)f8(true)elseif fu=="always"then f8(true)fs(true)elseif fu=="never"then f8(false)else b.warn("Ignoring unknown visibility mode '"..fu.."'")return end;e.visibility=fu;mp.set_property_native("user-data/osc/visibility",fu)if not fv and tonumber(mp.get_property("osd-level"))>=1 then mp.osd_message("OSC visibility: "..fu)end;mp.disable_key_bindings("input")mp.disable_key_bindings("window-controls")X.input_enabled=false;b9()bc()end;local function fx(fu,fv)if fu=="cycle"then if e.idlescreen then fu="no"else fu="yes"end end;if fu=="yes"then e.idlescreen=true else e.idlescreen=false end;mp.set_property_native("user-data/osc/idlescreen",e.idlescreen)if not fv and tonumber(mp.get_property("osd-level"))>=1 then mp.osd_message("OSC logo visibility: "..tostring(fu))end;bc()end;mp.observe_property("pause","bool",function(f,eU)eT(f,eU)if e.showonpause and e.visibility~="never"then X.enabled=eU;if eU then if not X.temp_visibility_mode and e.visibility~="always"then X.temp_visibility_mode=e.visibility end;if e.keeponpause then ft("always",true)else eR()end else if X.temp_visibility_mode then ft(X.temp_visibility_mode,true)X.temp_visibility_mode=nil else ft(e.visibility,true)end end end end)mp.register_script_message("osc-visibility",ft)mp.register_script_message("osc-show",eR)mp.register_script_message("osc-hide",function()if e.visibility=="auto"then dM(false)end end)mp.add_key_binding(nil,"visibility",function()ft("cycle")end)mp.add_key_binding(nil,"progress-toggle",function()e.persistentprogress=not e.persistentprogress;X.persistent_progress_toggle=e.persistentprogress;bf()end)mp.register_script_message("osc-idlescreen",fx)mp.register_script_message("thumbfast-info",function(o)local fy=d.parse_json(o)if type(fy)~="table"or not fy.width or not fy.height then b.error("thumbfast-info: received json didn't produce a table with thumbnail information")else J=fy end end)local function fz()if e.window_top_bar~="auto"and e.window_top_bar~="yes"and e.window_top_bar~="no"then b.warn("window_top_bar cannot be '"..e.window_top_bar.."'. Ignoring.")e.window_top_bar="auto"end;if e.seek_handle_size<0 then b.warn("seek_handle_size must be 0 or higher. Setting it to 0 (minimum).")e.seek_handle_size=0 end;if e.volume_control_type~="linear"and e.volume_control_type~="logarithmic"then b.warn("volumecontrol cannot be '"..e.volume_control_type.."'. Ignoring.")e.volume_control_type="linear"end;if e.screenshot_flag~="subtitles"and e.screenshot_flag~="video"and e.screenshot_flag~="window"and e.screenshot_flag~="each-frame"and e.screenshot_flag~="subtitles+each-frame"and e.screenshot_flag~="video+each-frame"and e.screenshot_flag~="window+each-frame"then b.warn("screenshot_flag cannot be '"..e.screenshot_flag.."'. Ignoring.")e.screenshot_flag="subtitles"end;if not j[e.language]then b.warn("language '"..e.language.."' not found. Ignoring.")e.language="en"if not j["en"]then b.warn("ERROR: can't find the default 'en' language or the one set by user_opts.")end end;local fA={e.osc_color,e.seekbarfg_color,e.seekbarbg_color,e.title_color,e.time_color,e.side_buttons_color,e.middle_buttons_color,e.playpause_color,e.window_title_color,e.window_controls_color,e.held_element_color,e.thumbnail_border_color,e.chapter_title_color,e.seekbar_cache_color,e.hover_effect_color,e.windowcontrols_close_hover,e.windowcontrols_max_hover,e.windowcontrols_min_hover,e.cache_info_color,e.thumbnail_border_outline}for H,R in pairs(fA)do if R:find("^#%x%x%x%x%x%x$")==nil then b.warn("'"..R.."' is not a valid color")end end;for G in string.gmatch(e.visibility_modes,"([^_]+)")do if G~="auto"and G~="always"and G~="never"then b.warn("Ignoring unknown visibility mode '"..G.."' in list")else table.insert(X.visibility_modes,G)end end end;c.read_options(e,"modernz",function(fB)fz()A()y()T()a5(fB.timetotal,fB.timems)if fB.tick_delay or fB.tick_delay_follow_display_fps then fo("display_fps",mp.get_property_number("display_fps"))end;bc()ft(e.visibility,true)fm()bf()end)fz()A()y()T()a5(true,true)fo("display_fps",mp.get_property_number("display_fps"))ft(e.visibility,true)fm()ag(0,0,0,0,"input")ag(0,0,0,0,"window-controls")ag(0,0,0,0,"window-controls-title")